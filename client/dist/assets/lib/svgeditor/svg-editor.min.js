var mysvgeditor=function(){return{initSvgEditor:function(e,t,n,o,i,a){window.svgEditor=function(e){function l(t,n){var o=r.setSvgString(t)!==!1;n=n||e.noop,o?n(!0):e.alert(y.notification.errorLoadingSVG,function(){n(!1)})}var s={};e(document).unbind("keydown"),s.tool_scale=1,s.exportWindowCt=0,s.langChanged=!1,s.showSaveWarning=!1,s.storagePromptClosed=!1,s.extensionLoadedCallback=n,s.onSelectedElement=t,s.changeColor=o,s.onGaugeAdded=i,s.onGaugeRemoved=a,s.currentExtensionsInteractivityType=[];var r,c,u=svgedit.utilities,d=!1,f=!1,p=!1,v=[],g={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},h={},m={extensions:[],allowedOrigins:[]},_=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-panning.js","ext-storage.js"],w={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:1,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",exportWindowType:"new",wireframe:!1,showlayers:!1,no_save_warning:!1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:!0,gridColor:"#000",baseUnit:"px",snappingStep:2,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},y=s.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};return e.pref=function(e,t){return t?(h[e]=t,void(s.curPrefs=h)):e in h?h[e]:g[e]},s.loadContentAndPrefs=function(){if(m.forceStorage||!m.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){if(s.storage&&(m.forceStorage||!m.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var e="svgedit-"+m.canvasName,t=s.storage.getItem(e);t&&s.loadFromString(t)}var n;for(n in g)if(g.hasOwnProperty(n)){var o="web-edit-"+n;if(s.storage){var i=s.storage.getItem(o);i&&(g[n]=String(i))}else if(window.widget)g[n]=widget.preferenceForKey(o);else{var a=document.cookie.match(new RegExp("(?:^|;\\s*)"+u.preg_quote(encodeURIComponent(o))+"=([^;]+)"));g[n]=a?decodeURIComponent(a[1]):""}}}},s.setConfig=function(t,n){function o(t,n,o){t[n]&&"object"==typeof t[n]?e.extend(!0,t[n],o):t[n]=o}n=n||{},e.each(t,function(i,a){if(t.hasOwnProperty(i))if(g.hasOwnProperty(i)){if(n.overwrite===!1&&(m.preventAllURLConfig||h.hasOwnProperty(i)))return;n.allowInitialUserOverride===!0?g[i]=a:e.pref(i,a)}else if(["extensions","allowedOrigins"].indexOf(i)>-1){if(n.overwrite===!1&&(m.preventAllURLConfig||"allowedOrigins"===i||"extensions"===i&&m.lockExtensions))return;m[i]=m[i].concat(a)}else if(w.hasOwnProperty(i)){if(n.overwrite===!1&&(m.preventAllURLConfig||m.hasOwnProperty(i)))return;if(m.hasOwnProperty(i)){if(n.overwrite===!1)return;o(m,i,a)}else n.allowInitialUserOverride===!0?o(w,i,a):w[i]&&"object"==typeof w[i]?(m[i]={},e.extend(!0,m[i],a)):m[i]=a}}),s.curConfig=m},s.setCustomHandlers=function(t){s.ready(function(){t.open&&(e('#tool_open > input[type="file"]').remove(),e("#tool_open").show(),r.open=t.open),t.save&&(s.showSaveWarning=!1,r.bind("saved",t.save)),t.exportImage&&(f=t.exportImage,r.bind("exported",f)),t.exportPDF&&(p=t.exportPDF,r.bind("exportedPDF",p))})},s.randomizeIds=function(){r.randomizeIds(arguments)},s.init=function(){function t(){h=e.extend(!0,{},g,h),s.curPrefs=h}function n(){m=e.extend(!0,{},w,m),m.noDefaultExtensions||(m.extensions=m.extensions.concat(_)),e.each(["extensions","allowedOrigins"],function(t,n){m[n]=e.grep(m[n],function(e,t){return t===m[n].indexOf(e)})}),s.curConfig=m}function o(t,n){var o=t.id,i=o.split("_"),a=i[0],l=i[1];n&&r.setStrokeAttr("stroke-"+a,l),ge(),A("#cur_"+a,o,20),e(t).addClass("current").siblings().removeClass("current")}function i(t,n){e.pref("bkgd_color",t),e.pref("bkgd_url",n),r.setBackground(t,n)}function d(){var t=r.getHref(ee);if(t=0===t.indexOf("data:")?"":t,s.promptImgURLcallback){var n=s.promptImgURLcallback;n&&_e(n)}else e.prompt(y.notification.enterNewImgURL,t,function(e){e&&_e(e)})}function v(t,n){n||(n=r.getZoom()),t||(t=e("#svgcanvas"));var o,i,a=3e4,l=r.getContentElem(),s=svgedit.units.getTypeMap(),c=s[m.baseUnit];for(o=0;o<2;o++){var u=0===o,d=u?"x":"y",f=u?"width":"height",p=Number(l.getAttribute(d)),v=e("#ruler_"+d+" canvas:first"),g=v.clone();v.replaceWith(g);var h=g[0],_=t[f](),w=_;h.parentNode.style[f]=w+"px";var y,b,k,x=0,C=h.getContext("2d");if(C.fillStyle="#666666",C.fillRect(0,0,h.width,h.height),g.siblings().remove(),_>=a){k=parseInt(_/a,10)+1,y=[],y[0]=C;var S;for(i=1;i<k;i++)h[f]=a,S=h.cloneNode(!0),h.parentNode.appendChild(S),y[i]=S.getContext("2d");S[f]=_%a,_=a}h[f]=_;var L=c*n,T=50/L,E=1;for(i=0;i<re.length&&(b=re[i],E=b,!(T<=b));i++);var N=E*L;C.font="8px sans-serif";for(var P=p/L%E*L,A=P-N;P<w;){A+=N,C.fillStyle="#CACACA";var I=Math.round(P)+.5;u?(C.moveTo(I,15),C.lineTo(I,0)):(C.moveTo(15,I),C.lineTo(0,I)),b=(A-p)/L;var D;if(E>=1)D=Math.round(b);else{var U=String(E).split(".")[1].length;D=b.toFixed(U)}if(0!==D&&1e3!==D&&D%1e3===0&&(D=D/1e3+"K"),u)C.fillText(D,P+2,8);else{var F=String(D).split("");for(i=0;i<F.length;i++)C.fillText(F[i],1,P+9+9*i)}var M=N/10;for(i=1;i<10;i++){var O=Math.round(P+M*i)+.5;if(y&&O>_){if(x++,C.stroke(),x>=k){i=10,P=w;continue}C=y[x],P-=a,O=Math.round(P+M*i)+.5}var R=i%2?12:10;u?(C.moveTo(O,15),C.lineTo(O,R)):(C.moveTo(15,O),C.lineTo(R,O))}P+=N}C.strokeStyle="#666666",C.stroke()}}function b(){r.deleteCurrentLayer()&&(ke(),ue(),e("#layerlist tr.layer").removeClass("layersel"),e("#layerlist tr.layer:first").addClass("layersel"))}function k(){var t=r.getCurrentDrawing().getCurrentLayerName()+" copy";e.prompt(y.notification.enterUniqueLayerName,t,function(t){if(t){if(r.getCurrentDrawing().hasLayer(t))return void e.alert(y.notification.dupeLayerName);r.cloneLayer(t),ke(),ue()}})}function x(){e("#layerlist tr.layersel").index()!=r.getCurrentDrawing().getNumLayers()-1&&(r.mergeLayer(),ke(),ue())}function C(t){var n=e("#layerlist tr.layersel").index(),o=r.getCurrentDrawing().getNumLayers();(n>0||n<o-1)&&(n+=t,r.setCurrentLayerPosition(o-n-1),ue())}function S(e,t){var n=Number(e.value),o=n+t,i=o>=n;return 0===t?n:n>=24?i?Math.round(1.1*n):Math.round(n/1.1):n<=1?i?2*n:n/2:o}function L(e,t){var n=Number(e.value);if(0===n)return 100;var o=n+t;return 0===t?n:n>=100?o:o>=n?2*n:n/2}function T(e){e.stopPropagation(),e.preventDefault()}function E(e){e.stopPropagation(),e.preventDefault()}function N(e){e.stopPropagation(),e.preventDefault()}try{"localStorage"in window&&(s.storage=localStorage)}catch(e){}var P=[];e("#lang_select option").each(function(){P.push(this.value)}),function(){var o,i;if(c=e.deparam.querystring(!0),e.isEmptyObject(c))n(),s.loadContentAndPrefs(),t();else{if(c.dimensions&&(c.dimensions=c.dimensions.split(",")),c.bkgd_color&&(c.bkgd_color="#"+c.bkgd_color),c.extensions&&(c.extensions=c.extensions.match(/[:\/\\]/)?"":c.extensions.split(",")),e.each(["extPath","imgPath","langPath","jGraduatePath"],function(e){c[e]&&delete c[e]}),s.setConfig(c,{overwrite:!1}),n(),!m.preventURLContentLoading){if(o=c.source,i=e.param.querystring(),o||i.indexOf("source=data:")>=0&&(o=i.match(/source=(data:[^&]*)/)[1]),o)return void(0===o.indexOf("data:")?s.loadFromDataURI(o):s.loadFromString(o));if(c.url)return void s.loadFromURL(c.url)}c.noStorageOnLoad&&!m.forceStorage||s.loadContentAndPrefs(),t()}}(),function(){var e,t=window.opener;if(t)try{e=t.document.createEvent("Event"),e.initEvent("svgEditorReady",!0,!0),t.document.documentElement.dispatchEvent(e)}catch(e){}}();var A=s.setIcon=function(t,n,o){var i="string"==typeof n?e.getSvgIcon(n,!0):n.clone();i&&e(t).empty().append(i)},I=function(){window.extOverview&&window.extOverview(),window.extMarkers&&window.extMarkers(),window.extConnector&&window.extConnector(),window.extEyedropper&&window.extEyedropper(),window.extShapes&&window.extShapes(),window.extImagelib&&window.extImagelib(),window.extGrid&&window.extGrid(),window.extPanning&&window.extPanning(),window.extStorage&&window.extStorage(),window.extSwitch&&window.extSwitch(),window.extCompressors&&window.extCompressors(),window.extExchangers&&window.extExchangers(),window.extValveA&&window.extValveA(),window.extValves&&window.extValves(),window.extMotors&&window.extMotors(),window.extValue&&window.extValue(),window.extHtmlInput&&window.extHtmlInput(),window.extHtmlSelect&&window.extHtmlSelect(),window.extHtmlButton&&window.extHtmlButton(),window.extGaugeProgress&&window.extGaugeProgress(),window.extGaugeSemaphore&&window.extGaugeSemaphore(),s.currentExtensionsInteractivityType=r.getExtensionMember("getClassId"),s.putLocale&&s.putLocale(null,P)};"file:"===document.location.protocol?setTimeout(I,100):setTimeout(I,2e3),s.canvas=r=new e.SvgCanvas(document.getElementById("svgcanvas"),m);var D,U,F,M,O,R=["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],z=svgedit.browser.isMac()?"meta+":"ctrl+",G=r.pathActions,j=r.undoMgr,B=m.imgPath+"logo.png",W=e("#workarea"),V=e("#cmenu_canvas"),H=null,q="crosshair",Q="crosshair",Z="toolbars",K="",X={fill:null,stroke:null};(function(){e("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var t=e("#dialog_box"),n=e("#dialog_buttons"),o=e("#dialog_content"),i=function(i,a,l,s,r,c,u){var d,f,p;if(o.html("<p>"+a.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"==i),n.empty(),d=e('<input type="button" value="'+y.common.ok+'">').appendTo(n),"alert"!==i&&e('<input type="button" value="'+y.common.cancel+'">').appendTo(n).click(function(){t.hide(),l&&l(!1)}),"prompt"===i)f=e('<input type="text">').prependTo(n),f.val(s||""),f.bind("keydown","return",function(){d.click()});else if("select"===i){var v=e('<div style="text-align:center;">');if(f=e("<select>").appendTo(v),u){var g=e("<label>").text(u.label);p=e('<input type="checkbox">').appendTo(g),p.val(u.value),u.tooltip&&g.attr("title",u.tooltip),p.prop("checked",!!u.checked),v.append(e("<div>").append(g))}e.each(r||[],function(t,n){"object"==typeof n?f.append(e("<option>").val(n.value).html(n.text)):f.append(e("<option>").html(n))}),o.append(v),s&&f.val(s),c&&f.bind("change","return",c),f.bind("keydown","return",function(){d.click()})}else"process"===i&&d.hide();t.show(),d.click(function(){t.hide();var e="prompt"!==i&&"select"!==i||f.val();l&&(p?l(e,p.prop("checked")):l(e))}).focus(),"prompt"!==i&&"select"!==i||f.focus()};e.alert=function(e,t){i("alert",e,t)},e.confirm=function(e,t){i("confirm",e,t)},e.process_cancel=function(e,t){i("process",e,t)},e.prompt=function(e,t,n){i("prompt",e,n,t)},e.select=function(e,t,n,o,a,l){i("select",e,n,a,t,o,l)}})();var Y,J=function(){var t=e(".tool_button_current");t.length&&"tool_select"!==t[0].id&&(t.removeClass("tool_button_current").addClass("tool_button"),e("#tool_select").addClass("tool_button_current").removeClass("tool_button"),e("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")),r.setMode("select"),W.css("cursor","auto")},$=!1,ee=null,te=!1,ne=!1,oe=!1,ie=!1,ae=!1,le="",se=e("title:first").text(),re=[];for(Y=.1;Y<1e5;Y*=10)re.push(Y),re.push(2*Y),re.push(5*Y);var ce=function(e){var t,n=[],o=r.getCurrentDrawing().getNumLayers();for(t=0;t<o;t++)n[t]=r.getCurrentDrawing().getLayerName(t);if(e)for(t=0;t<o;++t)n[t]!=e&&r.getCurrentDrawing().setLayerOpacity(n[t],.5);else for(t=0;t<o;++t)r.getCurrentDrawing().setLayerOpacity(n[t],1)},ue=function(){r.clearSelection();for(var t=e("#layerlist tbody").empty(),n=e("#selLayerNames").empty(),o=r.getCurrentDrawing(),i=o.getCurrentLayerName(),a=r.getCurrentDrawing().getNumLayers(),l=e.getSvgIcon("eye");a--;){var s=o.getLayerName(a),c=e('<tr class="layer">').toggleClass("layersel",s===i),u=e('<td class="layervis">').toggleClass("layerinvis",!o.getLayerVisibility(s)),d=e('<td class="layername">'+s+"</td>");t.append(c.append(u,d)),n.append('<option value="'+s+'">'+s+"</option>")}if(void 0!==l){var f=l.clone();e("td.layervis",t).append(f),e.resizeSvgIcons({"td.layervis .svg_icon":14})}e("#layerlist td.layername").mouseup(function(t){e("#layerlist tr.layer").removeClass("layersel"),e(this.parentNode).addClass("layersel"),r.setCurrentLayer(this.textContent),t.preventDefault()}).mouseover(function(){ce(this.textContent)}).mouseout(function(){ce()}),e("#layerlist td.layervis").click(function(){var t=e(this.parentNode).prevAll().length,n=e("#layerlist tr.layer:eq("+t+") td.layername").text(),o=e(this).hasClass("layerinvis");r.setLayerVisibility(n,o),e(this).toggleClass("layerinvis")});for(var p=5-e("#layerlist tr.layer").size();p-- >0;)t.append('<tr><td style="color:white">_</td><td/></tr>')},de=function(t,n){oe||(oe=!0,K=r.getSvgString(),e("#save_output_btns").toggle(!!n),e("#tool_source_back").toggle(!n),e("#svg_source_textarea").val(K),e("#svg_source_editor").fadeIn(),e("#svg_source_textarea").focus())},fe=function(t,n){e("#path_node_panel").toggle(t),e("#tools_bottom_2,#tools_bottom_3").toggle(!t),t?(e(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),e("#tool_select").addClass("tool_button_current").removeClass("tool_button"),A("#tool_select","select_node"),te=!1,n.length&&(ee=n[0])):setTimeout(function(){A("#tool_select","select")},1e3)},pe=function(t,n){if(s.showSaveWarning=!1,n='<?xml version="1.0"?>\n'+n,svgedit.browser.isIE())return void de(0,!0);var o=t.open("data:image/svg+xml;base64,"+u.encode64(n)),i=e.pref("save_notice_done");if("all"!==i){var a=y.notification.saveFromBrowser.replace("%s","SVG");svgedit.browser.isGecko()?n.indexOf("<defs")!==-1?(a+="\n\n"+y.notification.defsFailOnSave,e.pref("save_notice_done","all"),i="all"):e.pref("save_notice_done","part"):e.pref("save_notice_done","all"),"part"!==i&&o.alert(a)}},ve=function(t,n){var o=n.issues,i=n.exportWindowName;i&&(H=window.open("",i)),H.location.href=n.datauri;var a=e.pref("export_notice_done");if("all"!==a){var l=y.notification.saveFromBrowser.replace("%s",n.type);if(o.length){var s="\n • ";l+="\n\n"+y.notification.noteTheseIssues+s+o.join(s)}e.pref("export_notice_done","all"),H.alert(l)}},ge=function(){window.opera&&e("<p/>").hide().appendTo("body").remove()},he=s.toolButtonClick=function(t,n){if(e(t).hasClass("disabled"))return!1;if(e(t).parent().hasClass("tools_flyout"))return!0;var o="normal";return n||e(".tools_flyout").fadeOut(o),e("#styleoverrides").text(""),W.css("cursor","auto"),e(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),e(t).addClass("tool_button_current").removeClass("tool_button"),!0},me=s.clickSelect=function(){he("#tool_select")&&(r.setMode("select"),e("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}"))},_e=s.setImageURL=function(t){t||(t=B),r.setImageURL(t),e("#image_url").val(t),0===t.indexOf("data:")?(e("#image_url").hide(),e("#change_image_url").hide()):(r.embedImage(t,function(n){e("#url_notice").toggle(!n),B=t}),e("#image_url").hide(),e("#change_image_url").hide())};s.promptImgURLcallback=null;var we=s.updateCanvas=function(t,n){var o=W.width(),i=W.height(),a=o,l=i,u=r.getZoom(),d=W,f=e("#svgcanvas"),p={x:d[0].scrollLeft+a/2,y:d[0].scrollTop+l/2},g=m.canvas_expansion;o=Math.max(a,r.contentW*u*g),i=Math.max(l,r.contentH*u*g),o==a&&i==l?W.css("overflow","hidden"):W.css("overflow","scroll");var h=f.height()/2,_=f.width()/2;f.width(o).height(i);var w=i/2,y=o/2,b=r.updateCanvas(o,i),k=y/_,x=o/2-a/2,C=i/2-l/2;if(n)n.x+=b.x,n.y+=b.y;else{var S=p.x-_,L=y+S*k,T=p.y-h,E=w+T*k;n={x:L,y:E}}t?r.contentW>d.width()?(W[0].scrollLeft=b.x-10,W[0].scrollTop=b.y-10):(d[0].scrollLeft=x,d[0].scrollTop=C):(d[0].scrollLeft=n.x-a/2,d[0].scrollTop=n.y-l/2),m.showRulers&&(v(f,u),W.scroll()),c.storagePrompt===!0||s.storagePromptClosed||e("#dialog_box").hide()},ye=function(){var t,n,o="none"==r.getColor("fill"),i="none"==r.getColor("stroke"),a=["#tool_fhpath","#tool_line"],l=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(i)for(t in a)n=a[t],e(n).hasClass("tool_button_current")&&me(),e(n).addClass("disabled");else for(t in a)n=a[t],e(n).removeClass("disabled");if(i&&o)for(t in l)n=l[t],e(n).hasClass("tool_button_current")&&me(),e(n).addClass("disabled");else for(t in l)n=l[t],e(n).removeClass("disabled");r.runExtensions("toolButtonStateUpdate",{nofill:o,nostroke:i}),e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show"),n=!1;e(this).children().each(function(){e(this).hasClass("disabled")||(n=!0)}),t.toggleClass("disabled",!n)}),ge()},be=function(){var t,n;if(null!=ee)switch(ee.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var i=null,a=ee.getElementsByTagName("*");for(t=0,n=a.length;t<n;t++){var l=a[t].getAttribute("stroke-width");0===t?i=l:i!==l&&(i=null)}e("#stroke_width").val(null===i?"1":i),X.fill.update(!0),X.stroke.update(!0);break;default:X.fill.update(!0),X.stroke.update(!0),e("#stroke_width").val(ee.getAttribute("stroke-width")||1),e("#stroke_style").val(ee.getAttribute("stroke-dasharray")||"none");var s=ee.getAttribute("stroke-linejoin")||"miter";0!=e("#linejoin_"+s).length&&o(e("#linejoin_"+s)[0]),s=ee.getAttribute("stroke-linecap")||"butt",0!=e("#linecap_"+s).length&&o(e("#linecap_"+s)[0])}if(null!=ee){var r=100*(ee.getAttribute("opacity")||1);e("#group_opacity").val(r),e("#opac_slider").slider("option","value",r),e("#elem_id").val(ee.id),e("#elem_class").val(ee.getAttribute("class"))}ye()},ke=function(){var t=ee;null==t||t.parentNode||(t=null);var n=r.getCurrentDrawing().getCurrentLayerName(),o=r.getMode(),i="px"!==m.baseUnit?m.baseUnit:null,a="pathedit"==o,l=e("#cmenu_canvas li");if(e("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel, #xy_panel, #marker_panel, #htmlctrl_panel, #tool_stroke, #tool_angle").hide(),ne||e("#tool_stroke").show(),null!=t){var c=t.nodeName;e("#tool_angle").show();var u=r.getRotationAngle(t);e("#angle").val(u);var f=r.getBlur(t);if(e("#blur").val(f),e("#blur_slider").slider("option","value",f),r.addedNew&&"image"===c&&0!==r.getHref(t).indexOf("data:")&&d(),a||"pathedit"==o){var p=G.getNodePoint();if(e("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),e("#tool_node_delete").toggleClass("disabled",!G.canDeleteNodes),A("#tool_openclose_path",G.closed_subpath?"open_path":"close_path"),p){var v=e("#seg_type");i&&(p.x=svgedit.units.convertUnit(p.x),p.y=svgedit.units.convertUnit(p.y)),e("#path_node_x").val(p.x),e("#path_node_y").val(p.y),p.type?v.val(p.type).removeAttr("disabled"):v.val(4).attr("disabled","disabled")}return}if(e("#selected_panel").show(),["line","circle","ellipse"].indexOf(c)>=0)e("#xy_panel").hide();else{var g,h;if(["g","polyline","path"].indexOf(c)>=0){var _=r.getStrokedBBox([t]);_&&(g=_.x,h=_.y)}else g=t.getAttribute("x"),h=t.getAttribute("y");i&&(g=svgedit.units.convertUnit(g),h=svgedit.units.convertUnit(h));t.getAttribute("width"),t.getAttribute("heght");g=Number.parseFloat(g),g=g.toFixed(Number.isInteger(g)?0:2),h=Number.parseFloat(h),h=h.toFixed(Number.isInteger(h)?0:2),e("#selected_x").val(g||0),e("#selected_y").val(h||0),e("#xy_panel").show()}var w=["image","text","path","g","use"].indexOf(c)==-1;e("#tool_topath").toggle(w),e("#tool_reorient").toggle("path"===c),e("#tool_reorient").toggleClass("disabled",0===u);var y={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]},b=t.tagName,k=null;if("a"===b&&(k=r.getHref(t),e("#g_panel").show()),"a"===t.parentNode.tagName&&(e(t).siblings().length||(e("#a_panel").show(),k=r.getHref(t.parentNode))),e("#tool_make_link, #tool_make_link").toggle(!k),k&&e("#link_url").val(k),y[b]){var x=y[b];if(e("#"+b+"_panel").show(),e.each(x,function(n,o){var i=t.getAttribute(o);if("px"!==m.baseUnit&&t[o]){var a=t[o].baseVal.value;i=svgedit.units.convertUnit(a)}e("#"+b+"_"+o).val(i||0)}),"text"==b)e("#text_panel").css("display","inline"),r.getItalic()?e("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):e("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),r.getBold()?e("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):e("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),e("#font_family").val(t.getAttribute("font-family")),e("#font_size").val(t.getAttribute("font-size")),e("#text_anchor").val(t.getAttribute("text-anchor")),e("#text").val(t.textContent),r.addedNew&&setTimeout(function(){e("#text").focus().select()},100);else if("image"==b)_e(r.getHref(t));else if("g"===b||"use"===b){e("#container_panel").show();r.getTitle()}else"line"===b&&e("#marker_panel").show()}l[("g"===b?"en":"dis")+"ableContextMenuItems"]("#ungroup"),l[("g"!==b&&te?"en":"dis")+"ableContextMenuItems"]("#group")}else te?(e("#multiselected_panel").show(),l.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):l.disableContextMenuItems("#interactivity,#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");if(ne&&!te&&(l.disableContextMenuItems("#ungroup"),e("#g_panel").hide()),e("#tool_undo").toggleClass("disabled",0===j.getUndoStackSize()),e("#tool_redo").toggleClass("disabled",0===j.getRedoStackSize()),r.addedNew=!1,t&&!a||te?(e("#selLayerNames").removeAttr("disabled").val(n),V.enableContextMenuItems("#delete,#deselect,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):e("#selLayerNames").attr("disabled","disabled"),l.disableContextMenuItems("#interactivity"),t&&!te){var C=t.getAttribute("type");C&&s.currentExtensionsInteractivityType.indexOf(C)>-1&&l.enableContextMenuItems("#interactivity")}},xe=function(){if(!D){var t="#workarea.wireframe #svgcontent * { stroke-width: "+1/r.getZoom()+"px; }";e("#wireframe_rules").text(W.hasClass("wireframe")?t:"")}},Ce=function(t){t=t||r.getDocumentTitle();var n=se+(t?": "+t:"");e("title:first").text(n)},Se=function(e,t){var n=r.getMode();"select"===n&&J();var o="pathedit"==n;ee=1===t.length||null==t[1]?t[0]:null,te=t.length>=2&&null!=t[1],ne=!1;for(var i=0;i<t.length;i++)t[i]&&t[i].id&&0===t[i].id.indexOf("HX")&&(ne=!0);null!=ee&&(o||be()),fe(o,t),ke(),r.runExtensions("selectedChanged",{elems:t,selectedElement:ee,multiselected:te});var a=[];if(te){for(var i=0;i<t.length;i++)a.push({id:t[i].id,type:t[i].getAttribute("type")});s.onSelectedElement(a)}else ee?(a.push({id:ee.id,type:ee.getAttribute("type")}),s.onSelectedElement(a)):s.onSelectedElement(null)},Le=function(t,n){var o=r.getMode(),i=n[0];if(i){if(te=n.length>=2&&null!=n[1],!te)switch(o){case"rotate":var a=r.getRotationAngle(i);e("#angle").val(a),e("#tool_reorient").toggleClass("disabled",0===a)}r.runExtensions("elementTransition",{elems:n})}},Te=function(e,t){var n,o=r.getMode();for("select"===o&&J(),n=0;n<t.length;++n){var i=t[n];i&&"svg"===i.tagName?(ue(),we()):i&&ee&&null==ee.parentNode&&(ee=i)}s.showSaveWarning=!0,ke(),ee&&"select"===o&&(X.fill.update(),X.stroke.update()),r.runExtensions("elementChanged",{elems:t})},Ee=function(){xe()},Ne=r.zoomChanged=function(t,n,o){var i=15,a=W,l=r.setBBoxZoom(n,a.width()-i,a.height()-i);if(l){var s=l.zoom,c=l.bbox;if(s<.001)return void F({value:.1});e("#zoom").val((100*s).toFixed(1)),o?we():we(!1,{x:c.x*s+c.width*s/2,y:c.y*s+c.height*s/2}),"zoom"==r.getMode()&&c.width&&J(),Ee()}};F=function(e){var t=e.value/100;if(t<.001)return void(e.value=.1);var n=r.getZoom(),o=W;Ne(window,{width:0,height:0,x:(o[0].scrollLeft+o.width()/2)/n,y:(o[0].scrollTop+o.height()/2)/n,zoom:t},!0)},e("#cur_context_panel").delegate("a","click",function(){var t=e(this);return t.attr("data-root")?r.leaveContext():r.setContext(t.text()),r.clearSelection(),!1});var Pe=function(t,n){var o="";if(n){var i="";o='<a href="#" data-root="y">'+r.getCurrentDrawing().getCurrentLayerName()+"</a>",e(n).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(i+=" > "+this.id,o+=this!==n?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),le=i}else le=null;e("#cur_context_panel").toggle(!!n).html(o),Ce()},Ae=function(){X.fill.prep(),X.stroke.prep()},Ie={},De=function(){e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show");if(!t.data("isLibrary")){var n=[];e(this).children().each(function(){n.push(this.title)}),t[0]&&(t[0].title=n.join(" / "))}})},Ue=function(){e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show"),n=t.offset(),o=t.outerWidth();n&&e(this).css({left:(n.left+o)*s.tool_scale,top:n.top})})},Fe=function(t){e.each(t,function(n,o){var i=e(n).children(),a=n+"_show",l=e(a),s=!1;i.addClass("tool_button").unbind("click mousedown mouseup").each(function(n){var i=o[n];Ie[i.sel]=i.fn,i.isDefault&&(s=n);var r=function(n){var o=i;if("keydown"===n.type){var s=e(o.parent+"_show").hasClass("tool_button_current"),r=e(o.parent+"_show").attr("data-curopt");e.each(t[i.parent],function(e,a){a.sel==r&&(o=n.shiftKey&&s?t[i.parent][e+1]||t[i.parent][0]:a)})}if(e(this).hasClass("disabled"))return!1;he(a)&&o.fn();var c;c=o.icon?e.getSvgIcon(o.icon,!0):e(o.sel).children().eq(0).clone(),c[0].setAttribute("width",l.width()),c[0].setAttribute("height",l.height()),l.children(":not(.flyout_arrow_horiz)").remove(),l.append(c).attr("data-curopt",o.sel)};e(this).mouseup(r),i.key&&e(document).bind("keydown",i.key[0]+" shift+"+i.key[0],r)}),s?l.attr("data-curopt",o[s].sel):l.attr("data-curopt")||l.attr("data-curopt",o[0].sel);var r,c=e(a).position();l.mousedown(function(t){if(l.hasClass("disabled"))return!1;var o=e(n),i=c.left+34,a=o.width()*-1,s=o.data("shown_popop")?200:0;r=setTimeout(function(){l.data("isLibrary")?o.css("left",i).show():o.css("left",a).show().animate({left:i},150),o.data("shown_popop",!0)},s),t.preventDefault()}).mouseup(function(t){clearTimeout(r);var n=e(this).attr("data-curopt");return l.data("isLibrary")&&e(a.replace("_show","")).is(":visible")?void he(a,!0):void(he(a)&&Ie[n]&&Ie[n]())})}),De(),Ue()},Me=function(t,n){var o=e("<div>",{class:"tools_flyout",id:t}).appendTo("#svg_editor").append(n);return o},Oe=function(){var e,t=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,n=document.getElementsByTagName("script")[0];for(e in n.style)if(t.test(e))return e.match(t)[0];return"WebkitOpacity"in n.style?"Webkit":"KhtmlOpacity"in n.style?"Khtml":""}(),Re=function(t,n){var o=["top","left","bottom","right"];t.each(function(){var t,i=e(this),a=i.outerWidth()*(n-1),l=i.outerHeight()*(n-1);for(t=0;t<4;t++){var s=o[t],r=i.data("orig_margin-"+s);null==r&&(r=parseInt(i.css("margin-"+s),10),i.data("orig_margin-"+s,r));var c=r*n;"right"===s?c+=a:"bottom"===s&&(c+=l),i.css("margin-"+s,c)}})},ze=s.setIconSize=function(t){var n="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout",o=e(n),i=1;if("number"==typeof t)i=t;else{var a={s:.75,m:1,l:1.25,xl:1.5};i=a[t]}s.tool_scale=i,Ue();var l=o.parents(":hidden");l.css("visibility","hidden").show(),Re(o,i),l.css("visibility","visible").hide(),e.pref("iconsize",t),e("#iconsize").val(t);var r={"#tools_top":{left:50+e("#main_button").width(),height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},c=e("#tool_size_rules");if(c.length?c.empty():c=e('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==t){var u="";e.each(r,function(n,o){n="#svg_editor "+n.replace(/,/g,", #svg_editor"),u+=n+"{",e.each(o,function(e,n){var o;"number"==typeof n?o=n*i+"px":(n[t]||n.all)&&(o=n[t]||n.all),u+=e+":"+o+";"}),u+="}"});var d="-"+Oe.toLowerCase()+"-";u+=n+"{"+d+"transform: scale("+i+");} #svg_editor div.toolset .toolset {"+d+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+d+"transform: scale("+1/i+");}",c.text(u)}Ue()},Ge=function(t,n,o,i){var a=e(t);n=e(n);var l=!1,s=i.dropUp;s&&e(t).addClass("dropup"),n.find("li").bind("mouseup",function(){i.seticon&&(A("#cur_"+a[0].id,e(this).children()),e(this).addClass("current").siblings().removeClass("current")),o.apply(this,arguments)}),e(window).mouseup(function(e){l||(a.removeClass("down"),n.hide(),n.css({top:0,left:0})),l=!1}),a.bind("mousedown",function(){var e=a.offset();s?(e.top-=n.height(),e.left+=8):e.top+=a.height(),n.offset(e),a.hasClass("down")?(n.hide(),n.css({top:0,left:0})):(n.show(),l=!0),a.toggleClass("down")}).hover(function(){l=!0}).mouseout(function(){l=!1}),i.multiclick&&n.mousedown(function(){l=!0})},je=[],Be=function(t,n){function o(){U&&(clearTimeout(U),U=null),a||(U=setTimeout(function(){a=!0,ze(e.pref("iconsize"))},50))}if(n){var i=!1,a=!1,l=!0;if(n.langReady)if(s.langChanged){var r=e.pref("lang");n.langReady({lang:r,uiStrings:y})}else je.push(n);var c=function(){n.callback&&!i&&l&&(i=!0,n.callback())},u=[];if(n.context_tools&&e.each(n.context_tools,function(t,n){var o,i=n.container_id?' id="'+n.container_id+'"':"",a=e("#"+n.panel);switch(a.length||(a=e("<div>",{id:n.panel}).appendTo("#tools_top")),n.type){case"tool_button":o='<div class="tool_button">'+n.id+"</div>";var l=e(o).appendTo(a);n.events&&e.each(n.events,function(t,n){e(l).bind(t,n)});break;case"select":o="<label"+i+'><select id="'+n.id+'">',e.each(n.options,function(e,t){var i=e==n.defval?" selected":"";o+='<option value="'+e+'"'+i+">"+t+"</option>"}),o+="</select></label>";var s=e(o).appendTo(a).find("select");e.each(n.events,function(t,n){e(s).bind(t,n)});break;case"button-select":o='<div id="'+n.id+'" class="dropdown toolset" title="'+n.title+'"><div id="cur_'+n.id+'" class="icon_label"></div><button></button></div>';var r=e('<ul id="'+n.id+'_opts"></ul>').appendTo("#option_lists");n.colnum&&r.addClass("optcols"+n.colnum);e(o).appendTo(a).children();u.push({elem:"#"+n.id,list:"#"+n.id+"_opts",title:n.title,callback:n.events.change,cur:"#cur_"+n.id});break;case"input":o="<label"+i+'><span id="'+n.id+'_label">'+n.label+':</span><input id="'+n.id+'" title="'+n.title+'" size="'+(n.size||"4")+'" value="'+(n.defval||"")+'" type="text"/></label>';var c=e(o).appendTo(a).find("input");n.spindata&&c.SpinButton(n.spindata),n.events&&e.each(n.events,function(e,t){c.bind(e,t)})}}),n.buttons){var d={},f={},p=n.svgicons,v={};
e.each(n.buttons,function(t,n){for(var o,i,a,l=n.id,s=t;e("#"+l).length;)l=n.id+"_"+ ++s;p||void 0==p?(d[l]=n.icon,i=n.svgicon||n.id,"app_menu"==n.type?f["#"+l+" > div"]=i:f["#"+l]=i):o=e('<img src="'+n.icon+'">');var r,c;switch(n.type){case"mode_flyout":case"mode":r="tool_button",c="#tools_left";break;case"context":r="tool_button",c="#"+n.panel,e(c).length||e("<div>",{id:n.panel}).appendTo("#tools_top");break;case"app_menu":r="",c="#main_menu ul"}var u,g,h,m,_,w=e(n.list||"app_menu"==n.type?"<li/>":"<div/>").attr("id",l).attr("title",n.title).addClass(r);if(n.includeWith||n.list){if(n.list)w.addClass("push_button"),e("#"+n.list+"_opts").append(w),n.isDefault&&(e("#cur_"+n.list).append(w.children().clone()),i=n.svgicon||n.id,f["#cur_"+n.list]=i);else if(n.includeWith){var y=n.includeWith;_=e(y.button),u=_.parent(),_.parent().hasClass("tools_flyout")||(a=_[0].id.replace("tool_","tools_"),h=_.clone().attr("id",a+"_show").append(e("<div>",{class:"flyout_arrow_horiz"})),_.before(h),u=Me(a,_)),m=M.getButtonData(y.button),y.isDefault&&(f["#"+a+"_show"]=n.id),g=v["#"+u[0].id]=[{sel:"#"+l,fn:n.events.click,icon:n.id,key:n.key,isDefault:n.includeWith?n.includeWith.isDefault:0},m];var b="position"in y?y.position:"last",k=u.children().length;!isNaN(b)&&b>=0&&b<k?u.children().eq(b).before(w):(u.append(w),g.reverse())}}else"position"in n?e(c).children().eq(n.position).length?e(c).children().eq(n.position).before(w):e(c).children().last().before(w):w.appendTo(c),"mode_flyout"==n.type?(_=e(w),u=_.parent(),_.parent().hasClass("tools_flyout")||(a=_[0].id.replace("tool_","tools_"),h=_.clone().attr("id",a+"_show").append(e("<div>",{class:"flyout_arrow_horiz"})),_.before(h),u=Me(a,_),u.data("isLibrary",!0),h.data("isLibrary",!0)),f["#"+a+"_show"]=n.id,g=v["#"+u[0].id]=[{sel:"#"+l,fn:n.events.click,icon:n.id,isDefault:!0},m]):"app_menu"==n.type&&w.append("<div>").append(n.title);p||w.append(o),n.list||e.each(n.events,function(t,o){"click"==t&&"mode"==n.type?(n.includeWith?w.bind(t,o):w.bind(t,function(){he(w)&&o()}),n.key&&(e(document).bind("keydown",n.key,o),n.title&&w.attr("title",n.title+" ["+n.key+"]"))):w.bind(t,o)}),Fe(v)}),e.each(u,function(){Ge(this.elem,this.list,this.callback,{seticon:!0})}),p&&(l=!1),e.svgIcons(p,{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback:d,placement:f,callback:function(t){"m"!==e.pref("iconsize")&&o(),l=!0,c()}})}n.mySetMarker&&(s.setMarker=n.mySetMarker),c()}},We=function(t,n,o){var i={alpha:n};if(0===t.indexOf("url(#")){var a=r.getRefElem(t);a=a?a.cloneNode(!0):e("#"+o+"_color defs *")[0],i[a.tagName]=a}else 0===t.indexOf("#")?i.solidColor=t.substr(1):i.solidColor="none";return new e.jGraduate.Paint(i)};e("#text").focus(function(){$=!0}),e("#text").blur(function(){$=!1}),r.bind("selected",Se),r.bind("transition",Le),r.bind("changed",Te),r.bind("saved",pe),r.bind("exported",ve),r.bind("exportedPDF",function(e,t){var n=t.exportWindowName;n&&(H=window.open("",n)),H.location.href=t.dataurlstring}),r.bind("zoomed",Ne),r.bind("contextset",Pe),r.bind("extension_added",Be),r.textActions.setInputElem(e("#text")[0]);var Ve='<div class="palette_item" style="background-color:#FFF;color:red;font-size:20px;line-height: 15px;text-align:center;" data-rgb="none">X</div>';e.each(R,function(e,t){Ve+='<div class="palette_item" style="background-color: '+t+';" data-rgb="'+t+'"></div>'}),e("#palette").append(Ve);var He=["#FFF","#888","#000"];Ve="",e.each(He,function(){Ve+='<div class="color_block" style="background-color:'+this+';"></div>'}),e("#bg_blocks").append(Ve);var qe=e("#bg_blocks div"),Qe="cur_background";qe.each(function(){var t=e(this);t.click(function(){qe.removeClass(Qe),e(this).addClass(Qe)})}),i(e.pref("bkgd_color"),e.pref("bkgd_url")),e("#image_save_opts input").val([e.pref("img_save")]);var Ze=function(e){r.setRectRadius(e.value)},Ke=function(e){r.setFontSize(e.value)},Xe=function(e){var t=e.value;0==t&&ee&&["line","polyline"].indexOf(ee.nodeName)>=0&&(t=e.value=1),r.setStrokeWidth(t)},Ye=function(t){r.setRotationAngle(t.value),e("#tool_reorient").toggleClass("disabled",0===parseInt(t.value,10))},Je=function(t,n){null==n&&(n=t.value),e("#group_opacity").val(n),t&&t.handle||e("#opac_slider").slider("option","value",n),r.setOpacity(n/100)},$e=function(t,n,o){null==n&&(n=t.value),e("#blur").val(n);var i=!1;t&&t.handle||(e("#blur_slider").slider("option","value",n),i=!0),o?r.setBlurNoUndo(n):r.setBlur(n,i)};e("#stroke_style").change(function(){r.setStrokeAttr("stroke-dasharray",e(this).val()),ge()}),e("#stroke_linejoin").change(function(){r.setStrokeAttr("stroke-linejoin",e(this).val()),ge()}),e("select").change(function(){e(this).blur()});var et=!1;e("#selLayerNames").change(function(){var t=this.options[this.selectedIndex].value,n=y.notification.QmoveElemsToLayer.replace("%s",t),o=function(e){e&&(et=!0,r.moveSelectedToLayer(t),r.clearSelection(),ue())};t&&(et?o(!0):e.confirm(n,o))}),e("#font_family").change(function(){r.setFontFamily(this.value)}),e("#seg_type").change(function(){r.setSegType(e(this).val())}),e("#text").keyup(function(){r.setTextContent(this.value)}),e("#image_url").change(function(){_e(this.value)}),e("#link_url").change(function(){this.value.length?r.setLinkURL(this.value):r.removeHyperlink()}),e("#g_title").change(function(){r.setGroupTitle(this.value)}),e(".attr_changer").change(function(){var t=this.getAttribute("data-attr"),n=this.value,o=svgedit.units.isValidUnit(t,n,ee);if(!o)return e.alert(y.notification.invalidAttrValGiven),this.value=ee.getAttribute(t),!1;if("id"!==t&&"class"!==t)if(isNaN(n))n=r.convertToNum(t,n);else if("px"!==m.baseUnit){var i=svgedit.units.getTypeMap();(ee[t]||"pathedit"===r.getMode()||"x"===t||"y"===t)&&(n*=i[m.baseUnit])}if("id"===t){var a=ee;r.clearSelection(),a.id=n,r.addToSelection([a],!0)}else r.changeSelectedAttribute(t,n);this.blur()}),e("#palette").mouseover(function(){var t=e('<input type="hidden">');e(this).append(t),t.focus().remove()}),e(".palette_item").mousedown(function(t){var n,o=t.shiftKey||2===t.button?"stroke":"fill",i=e(this).data("rgb");"none"===i||"transparent"===i||"initial"===i?(i="none",n=new e.jGraduate.Paint):n=new e.jGraduate.Paint({alpha:100,solidColor:i.substr(1)}),X[o].setPaint(n),r.setColor(o,i),"none"!==i&&1!==r.getPaintOpacity(o)&&r.setPaintOpacity(o,1),s.changeColor&&s.changeColor(o,i),ye()}).bind("contextmenu",function(e){e.preventDefault()}),e("#toggle_stroke_tools").on("click",function(){e("#tools_bottom").toggleClass("expanded")}),function(){var t=null,n=null,o=W[0],i=!1,a=!1;e("#svgcanvas").bind("mousemove mouseup",function(e){if(i!==!1)return o.scrollLeft-=e.clientX-t,o.scrollTop-=e.clientY-n,t=e.clientX,n=e.clientY,"mouseup"===e.type&&(i=!1),!1}).mousedown(function(e){if(1===e.button||a===!0)return i=!0,t=e.clientX,n=e.clientY,!1}),e(window).mouseup(function(){i=!1}),e(document).bind("keydown","space",function(e){r.spaceKey=a=!0,e.preventDefault()}).bind("keyup","space",function(e){e.preventDefault(),r.spaceKey=a=!1}).bind("keydown","shift",function(e){"zoom"===r.getMode()&&W.css("cursor",Q)}).bind("keyup","shift",function(e){"zoom"===r.getMode()&&W.css("cursor",q)}),s.setPanning=function(e){r.spaceKey=a=e}}(),function(){var t=e("#main_icon"),n=e("#main_icon span"),o=e("#main_menu"),i=!1,a=0,l=!0,s=!1;e(window).mouseup(function(n){i||(t.removeClass("buttondown"),"INPUT"!=n.target.tagName?o.fadeOut(200):s||(s=!0,e(n.target).click(function(){o.css("margin-left","-9999px").show()}))),i=!1}).mousedown(function(t){var n=e(t.target).closest("div.tools_flyout, .contextMenu").length;n||e(".tools_flyout:visible,.contextMenu").fadeOut(250)}),n.bind("mousedown",function(){t.hasClass("buttondown")?o.fadeOut(200):(o.css("margin-left",0).show(),a||(a=o.height()),o.css("height",0).animate({height:a},200),i=!0),t.toggleClass("buttondown buttonup")}).hover(function(){i=!0}).mouseout(function(){i=!1});var r=e("#main_menu li");r.mouseover(function(){l="rgba(0, 0, 0, 0)"==e(this).css("background-color"),r.unbind("mouseover"),l&&r.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),s.addDropDown=function(t,n,o){if(0!=e(t).length){var i=e(t).find("button"),a=e(t).find("ul").attr("id",e(t)[0].id+"-list"),l=!1;o?e(t).addClass("dropup"):e("#option_lists").append(a),a.find("li").bind("mouseup",n),e(window).mouseup(function(e){l||(i.removeClass("down"),a.hide()),l=!1}),i.bind("mousedown",function(){if(i.hasClass("down"))a.hide();else{if(!o){var n=e(t).position();a.css({top:n.top+24,left:n.left-10})}a.show(),l=!0}i.toggleClass("down")}).hover(function(){l=!0}).mouseout(function(){l=!1})}},s.addDropDown("#font_family_dropdown",function(){e("#font_family").val(e(this).text()).change()}),s.addDropDown("#opacity_dropdown",function(){if(!e(this).find("div").length){var t=parseInt(e(this).text().split("%")[0],10);Je(!1,t)}},!0),e("#opac_slider").slider({start:function(){e("#opacity_dropdown li:not(.special)").hide()},stop:function(){e("#opacity_dropdown li").show(),e(window).mouseup()},slide:function(e,t){Je(t)}}),s.addDropDown("#blur_dropdown",e.noop);var tt=!1;e("#blur_slider").slider({max:10,step:.1,stop:function(t,n){tt=!1,$e(n),e("#blur_dropdown li").show(),e(window).mouseup()},start:function(){tt=!0},slide:function(e,t){$e(t,null,tt)}}),s.addDropDown("#zoom_dropdown",function(){var t=e(this),n=t.data("val");n?Ne(window,n):F({value:parseFloat(t.text())})},!0),Ge("#stroke_linecap","#linecap_opts",function(){o(this,!0)},{dropUp:!0}),Ge("#stroke_linejoin","#linejoin_opts",function(){o(this,!0)},{dropUp:!0}),Ge("#tool_position","#position_opts",function(){var e=this.id.replace("tool_pos","").charAt(0);r.alignSelectedElements(e,"page")},{multiclick:!0}),function(){var t,n=function(){e(t).blur()};e("#svg_editor").find("button, select, input:not(#text)").focus(function(){t=this,Z="toolbars",W.mousedown(n)}).blur(function(){Z="canvas",W.unbind("mousedown",n),"textedit"==r.getMode()&&e("#text").focus()})}();var nt=function(){he("#tool_fhpath")&&r.setMode("fhpath")},ot=function(){he("#tool_line")&&r.setMode("line")},it=function(){he("#tool_square")&&r.setMode("square")},at=function(){he("#tool_rect")&&r.setMode("rect")},lt=function(){he("#tool_fhrect")&&r.setMode("fhrect")},st=function(){he("#tool_circle")&&r.setMode("circle")},rt=function(){he("#tool_ellipse")&&r.setMode("ellipse")},ct=function(){he("#tool_fhellipse")&&r.setMode("fhellipse")},ut=function(){he("#tool_image")&&r.setMode("image")},dt=function(){he("#tool_zoom")&&(r.setMode("zoom"),W.css("cursor",q))},ft=function(t){var n=r.getResolution();t=t?n.zoom*t:1,e("#zoom").val(100*t),r.setZoom(t),Ee(),we(!0)},pt=function(){he("#tool_zoom")&&(ft(),J())},vt=function(){he("#tool_text")&&r.setMode("text")},gt=function(){he("#tool_path")&&r.setMode("path")};s.clickExtension=function(e){r.clickExtension(e)},s.clickZoom=function(){r.setMode("zoom"),W.css("cursor",q)},s.clickToSetMode=function(e){r.setMode(e)},s.getSvgString=function(){return r.getSvgString()},s.getSelectedElements=function(){return r.getSelectedElems()},s.setSvgString=function(e){return r.setSvgString(e)},s.enableGridSnapping=function(e){m.gridSnapping=e},s.setDocProperty=function(e,t,n,o){return!("fit"!=t&&!svgedit.units.isValidUnit("width",t))&&(!("fit"!=n&&!svgedit.units.isValidUnit("height",n))&&(!!r.setResolution(t,n)&&(o||(o="#ffffff"),!(o&&!r.setBackground(o))&&void we())))},s.alignSelectedElements=function(e){r.alignSelectedElements(e,"page")},s.setColor=function(e,t,n){var o={alpha:t,solidColor:e,type:"solidColor"};X[n].setPaint(o),r.setPaint(n,o)},s.setStrokeOption=function(e){o(e,!0)},s.setFilterShadow=function(e){r.setFilterShadow(e)},s.setFontFamily=function(e){r.setFontFamily(e)},s.setTextAlign=function(e){r.setTextAlign(e)},s.clickClearAll=function(){var e=m.dimensions;J(),r.clear(),r.setResolution(e[0],e[1]),we(!0),ft(),ue(),ke(),Ae(),r.runExtensions("onNewDocument")},s.clearSelection=function(){r.clearSelection()},s.setMarker=function(e,t){console.log("marker selected "+e+" "+t)};var ht=function(){if(null!=ee||te){var e=r.deleteSelectedElements();null!=a&&a(e)}},mt=function(){(null!=ee||te)&&r.cutSelectedElements()},_t=function(){(null!=ee||te)&&r.copySelectedElements()},wt=function(){var e=r.getZoom(),t=(W[0].scrollLeft+W.width()/2)/e-r.contentW,n=(W[0].scrollTop+W.height()/2)/e-r.contentH;r.pasteElements("point",t,n)},yt=function(){null!=ee&&r.moveToTopSelectedElement()},bt=function(){null!=ee&&r.moveToBottomSelectedElement()},kt=function(e){null!=ee&&r.moveUpDownSelected(e)},xt=function(){null!=ee&&r.convertToPath()},Ct=function(){null!=ee&&G.reorient()},St=function(){(null!=ee||te)&&e.prompt(y.notification.enterNewLinkURL,"http://",function(e){e&&r.makeHyperlink(e)})},Lt=function(e,t){if(null!=ee||te){if(m.gridSnapping){var n=r.getZoom()*m.snappingStep;e*=n,t*=n}r.moveSelectedElements(e,t)}},Tt=function(){e("#tool_node_link").toggleClass("push_button_pressed tool_button");var t=e("#tool_node_link").hasClass("push_button_pressed");G.linkControlPoints(t)},Et=function(){G.getNodePoint()&&G.clonePathNode()},Nt=function(){G.getNodePoint()&&G.deletePathNode()},Pt=function(){var t=e("#tool_add_subpath"),n=!t.hasClass("push_button_pressed");t.toggleClass("push_button_pressed tool_button"),G.addSubPath(n)},At=function(){G.opencloseSubPath()},It=function(){r.cycleElement(1)},Dt=function(){r.cycleElement(0)},Ut=function(t,n){if(null!=ee&&!te){t||(n*=-1);var o=parseFloat(e("#angle").val())+n;r.setRotationAngle(o),ke()}};clickClear=function(){var t=m.dimensions;e.confirm(y.notification.QwantToClear,function(e){e&&(J(),r.clear(),r.setResolution(t[0],t[1]),we(!0),ft(),ue(),ke(),Ae(),r.runExtensions("onNewDocument"))})};var Ft=function(){return r.setBold(!r.getBold()),ke(),!1},Mt=function(){return r.setItalic(!r.getItalic()),ke(),!1},Ot=function(){var t={images:e.pref("img_save"),round_digits:6};r.save(t)},Rt=function(){e.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP","PDF"],function(t){function n(){var e=y.notification.loadingImage;"new"===m.exportWindowType&&s.exportWindowCt++,o=m.canvasName+s.exportWindowCt,H=window.open("data:text/html;charset=utf-8,"+encodeURIComponent("<title>"+e+"</title><h1>"+e+"</h1>"),o)}if(t){var o;if("PDF"===t)p||n(),r.exportPDF(o);else{f||n();var i=parseInt(e("#image-slider").val(),10)/100;r.rasterExport(t,i,o)}}},function(){var t=e(this);"JPEG"===t.val()||"WEBP"===t.val()?e("#image-slider").length||e('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(t.parent()):e("#image-slider").parent().remove()})},zt=function(){r.open()},Gt=function(){},jt=function(){j.getUndoStackSize()>0&&(j.undo(),ue())},Bt=function(){j.getRedoStackSize()>0&&(j.redo(),ue())},Wt=function(){te?r.groupSelectedElements():ee&&r.ungroupSelectedElement()},Vt=function(){r.cloneSelectedElements(20,20)},Ht=function(){var t=this.id.replace("tool_align","").charAt(0);r.alignSelectedElements(t,e("#align_relative_to").val())},qt=function(){if(e("#tool_wireframe").toggleClass("push_button_pressed tool_button"),W.toggleClass("wireframe"),!D){var t=e("#wireframe_rules");t.length?t.empty():t=e('<style id="wireframe_rules"></style>').appendTo("head"),xe()}};e("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var Qt=function(){if(!ie){ie=!0,e("#image_save_opts input").val([e.pref("img_save")]);var t=r.getResolution();"px"!==m.baseUnit&&(t.w=svgedit.units.convertUnit(t.w)+m.baseUnit,t.h=svgedit.units.convertUnit(t.h)+m.baseUnit),e("#canvas_width").val(t.w),e("#canvas_height").val(t.h),e("#canvas_title").val(r.getDocumentTitle()),e("#svg_docprops").show()}},Zt=function(){if(!ae){ae=!0,e("#main_menu").hide();var t=e("#bg_blocks div"),n="cur_background",o=h.bkgd_color,i=e.pref("bkgd_url");t.each(function(){var t=e(this),i=t.css("background-color")==o;t.toggleClass(n,i),i&&e("#canvas_bg_url").removeClass(n)}),o||t.eq(0).addClass(n),i&&e("#canvas_bg_url").val(i),e("#grid_snapping_on").prop("checked",m.gridSnapping),e("#grid_snapping_step").attr("value",m.snappingStep),e("#grid_color").attr("value",m.gridColor),e("#svg_prefs").show()}},Kt=function(){e("#svg_source_editor").hide(),oe=!1,e("#svg_source_textarea").blur()},Xt=function(){if(oe){var t=function(){r.clearSelection(),Kt(),ft(),ue(),Ce(),Ae()};r.setSvgString(e("#svg_source_textarea").val())?t():e.confirm(y.notification.QerrorsRevertToSource,function(e){return!!e&&void t()}),J()}},Yt=function(){e("#svg_docprops").hide(),e("#canvas_width,#canvas_height").removeAttr("disabled"),e("#resolution")[0].selectedIndex=0,e("#image_save_opts input").val([e.pref("img_save")]),ie=!1},Jt=function(){e("#svg_prefs").hide(),ae=!1},$t=function(){var t=e("#canvas_title").val();Ce(t),r.setDocumentTitle(t);var n=e("#canvas_width"),o=n.val(),i=e("#canvas_height"),a=i.val();return"fit"==o||svgedit.units.isValidUnit("width",o)?(n.parent().removeClass("error"),"fit"==a||svgedit.units.isValidUnit("height",a)?(i.parent().removeClass("error"),r.setResolution(o,a)?(e.pref("img_save",e("#image_save_opts :checked").val()),we(),void Yt()):(e.alert(y.notification.noContentToFitTo),!1)):(e.alert(y.notification.invalidAttrValGiven),i.parent().addClass("error"),!1)):(e.alert(y.notification.invalidAttrValGiven),n.parent().addClass("error"),!1)},en=s.savePreferences=function(){var t=e("#bg_blocks div.cur_background").css("background-color")||"#FFF";i(t,e("#canvas_bg_url").val());var n=e("#lang_select").val();n!==e.pref("lang")&&s.putLocale(n,P),ze(e("#iconsize").val()),m.gridSnapping=e("#grid_snapping_on")[0].checked,m.snappingStep=e("#grid_snapping_step").val(),m.gridColor=e("#grid_color").val(),m.showRulers=e("#show_rulers")[0].checked,e("#rulers").toggle(m.showRulers),m.showRulers&&v(),m.baseUnit=e("#base_unit").val(),r.setConfig(m),we(),Jt()},tn=e.noop,nn=function(){return e("#dialog_box").hide(),oe||ie||ae?(oe?K!==e("#svg_source_textarea").val()?e.confirm(y.notification.QignoreSourceChanges,function(e){e&&Kt()}):Kt():ie?Yt():ae&&Jt(),void tn()):void(le&&r.leaveContext())},on={width:e(window).width(),height:e(window).height()};if(svgedit.browser.isIE()&&function(){tn=function(){0===W[0].scrollLeft&&0===W[0].scrollTop&&(W[0].scrollLeft=O.left,W[0].scrollTop=O.top)},O={left:W[0].scrollLeft,top:W[0].scrollTop},e(window).resize(tn),s.ready(function(){setTimeout(function(){tn()},500)}),W.scroll(function(){O={left:W[0].scrollLeft,top:W[0].scrollTop}})}(),e(window).resize(function(t){e.each(on,function(t,n){var o=e(window)[t]();W[0]["scroll"+("width"===t?"Left":"Top")]-=(o-n)/2,on[t]=o}),Ue()}),function(){W.scroll(function(){0!=e("#ruler_x").length&&(e("#ruler_x")[0].scrollLeft=W[0].scrollLeft),0!=e("#ruler_y").length&&(e("#ruler_y")[0].scrollTop=W[0].scrollTop)})}(),e("#url_notice").click(function(){e.alert(this.title)}),e("#change_image_url").click(d),function(){var t=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],n="",o="tool_button_current";e.each(t,function(e,t){n+=(e?",":"")+"#tool_"+t}),e(n).mousedown(function(){e(this).addClass(o)}).bind("mousedown mouseout",function(){e(this).removeClass(o)}),e("#tool_undo, #tool_redo").mousedown(function(){e(this).hasClass("disabled")||e(this).addClass(o)}).bind("mousedown mouseout",function(){e(this).removeClass(o)})}(),svgedit.browser.isMac()&&!window.opera){var an=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(Y=an.length;Y--;){var ln=document.getElementById(an[Y]);if(ln){var sn=ln.title,rn=sn.indexOf("Ctrl+");ln.title=[sn.substr(0,rn),"Cmd+",sn.substr(rn+5)].join("")}}}var cn=function(t){var n="stroke_color"==t.attr("id")?"stroke":"fill",o=X[n].paint,i="stroke"==n?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity",a=t.offset();e("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(m.colorPickerCSS||{left:a.left-140,bottom:40}).jGraduate({paint:o,window:{pickerTitle:i},images:{clientPath:m.jGraduatePath},newstop:"inverse"},function(t){o=new e.jGraduate.Paint(t),X[n].setPaint(o),r.setPaint(n,o),e("#color_picker").hide()},function(){e("#color_picker").hide()})},un=function(t,n){var o,i,a=m["fill"===n?"initFill":"initStroke"],l=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+a.color+'" opacity="'+a.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml"),s=l.documentElement;s=e(t)[0].appendChild(document.importNode(s,!0)),s.setAttribute("width",16.5),this.rect=s.firstChild,this.defs=s.getElementsByTagName("defs")[0],this.grad=this.defs.firstChild,this.paint=new e.jGraduate.Paint({solidColor:a.color}),this.type=n,this.setPaint=function(e,t){this.paint=e;var n="none",a=e.type,l=e.alpha/100;switch(a){case"solidColor":n="none"!=e[a]?"#"+e[a]:e[a];break;case"linearGradient":case"radialGradient":this.defs.removeChild(this.grad),this.grad=this.defs.appendChild(e[a]);var s=this.grad.id="gradbox_"+this.type;n="url(#"+s+")"}this.rect.setAttribute("fill",n),this.rect.setAttribute("opacity",l),t&&(r.setColor(this.type,o,!0),r.setPaintOpacity(this.type,i,!0))},this.update=function(e){if(ee){var t,n,a=this.type;switch(ee.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":var l=null,s=ee.getElementsByTagName("*");for(t=0,n=s.length;t<n;t++){var c=s[t],u=c.getAttribute(a);if(0===t)l=u;else if(l!==u){l=null;break}}if(null===l)return void(o=null);o=l,i=1;break;default:i=parseFloat(ee.getAttribute(a+"-opacity")),isNaN(i)&&(i=1);var d="fill"===a?"black":"none";o=ee.getAttribute(a)||d}e&&(r.setColor(a,o,!0),r.setPaintOpacity(a,i,!0)),i*=100;var f=We(o,i,a);this.setPaint(f)}},this.prep=function(){var t=this.paint.type;switch(t){case"linearGradient":case"radialGradient":var o=new e.jGraduate.Paint({copy:this.paint});r.setPaint(n,o)}}};X.fill=new un("#fill_color","fill"),X.stroke=new un("#stroke_color","stroke"),e("#stroke_width").val(m.initStroke.width),e("#group_opacity").val(100*m.initOpacity);var dn=X.fill.rect.cloneNode(!1);dn.setAttribute("style","vector-effect:non-scaling-stroke"),D="non-scaling-stroke"===dn.style.vectorEffect,dn.removeAttribute("style");var fn=X.fill.rect.ownerDocument,pn=fn.createElementNS(svgedit.NS.SVG,"feGaussianBlur");void 0===pn.stdDeviationX&&e("#tool_blur").hide(),e(pn).remove(),function(){var e="-"+Oe.toLowerCase()+"-zoom-",t=e+"in";W.css("cursor",t),W.css("cursor")===t&&(q=t,Q=e+"out"),W.css("cursor","auto")}(),e("#fill_color, #tool_fill .icon_label").click(function(){cn(e("#fill_color")),ye()}),e("#stroke_color, #tool_stroke .icon_label").click(function(){cn(e("#stroke_color")),ye()}),e("#group_opacityLabel").click(function(){e("#opacity_dropdown button").mousedown(),e(window).mouseup()}),e("#zoomLabel").click(function(){e("#zoom_dropdown button").mousedown(),e(window).mouseup()}),e("#tool_move_top").mousedown(function(t){e("#tools_stacking").show(),t.preventDefault()}),e(".layer_button").mousedown(function(){e(this).addClass("layer_buttonpressed")}).mouseout(function(){e(this).removeClass("layer_buttonpressed")}).mouseup(function(){e(this).removeClass("layer_buttonpressed")}),e(".push_button").mousedown(function(){e(this).hasClass("disabled")||e(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){e(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){e(this).removeClass("push_button_pressed").addClass("push_button")}),e("#layer_new").click(function(){var t,n=r.getCurrentDrawing().getNumLayers();do t=y.layers.layer+" "+ ++n;while(r.getCurrentDrawing().hasLayer(t));e.prompt(y.notification.enterUniqueLayerName,t,function(t){if(t){if(r.getCurrentDrawing().hasLayer(t))return void e.alert(y.notification.dupeLayerName);r.createLayer(t),ke(),ue()}})}),e("#layer_delete").click(b),e("#layer_up").click(function(){C(-1)}),e("#layer_down").click(function(){C(1)}),e("#layer_rename").click(function(){var t=e("#layerlist tr.layersel td.layername").text();e.prompt(y.notification.enterNewLayerName,"",function(n){if(n){if(t==n||r.getCurrentDrawing().hasLayer(n))return void e.alert(y.notification.layerHasThatName);r.renameCurrentLayer(n),ue()}})});var vn=300,gn=150,hn=-1,mn=!1,_n=!1,wn=function(t){var n=e("#ruler_x");e("#sidepanels").width("+="+t),e("#layerpanel").width("+="+t),n.css("right",parseInt(n.css("right"),10)+t),W.css("right",parseInt(W.css("right"),10)+t),r.runExtensions("workareaResized")},yn=function(t){if(_n&&hn!=-1){mn=!0;var n=hn-t.pageX,o=e("#sidepanels").width();o+n>vn?(n=vn-o,o=vn):o+n<2&&(n=2-o,o=2),0!=n&&(hn-=n,wn(n))}},bn=function(t){var n=e("#sidepanels").width(),o=(n>2||t?2:gn)-n;wn(o)};e("#sidepanel_handle").mousedown(function(t){hn=t.pageX,e(window).mousemove(yn),_n=!1,setTimeout(function(){_n=!0},20)}).mouseup(function(e){mn||bn(),hn=-1,mn=!1}),e(window).mouseup(function(){hn=-1,mn=!1,e("#svg_editor").unbind("mousemove",yn)}),ue();var kn=function(){W.css("line-height",W.height()+"px")};e(window).bind("load resize",kn),e("#resolution").change(function(){var t=e("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"==this.value)t.val("fit").attr("disabled","disabled");else{var n=this.value.split("x");e("#canvas_width").val(n[0]),e("#canvas_height").val(n[1]),t.removeAttr("disabled")}else"fit"==e("#canvas_width").val()&&t.removeAttr("disabled").val(100)}),e("input,select").attr("autocomplete","off"),M=function(){var t=[{sel:"#tool_select",fn:me,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:nt,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:ot,evt:"click",key:["L",!0]},{sel:"#tool_rect",fn:at,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:it,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:lt,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:rt,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:st,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:ct,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:gt,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:vt,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:ut,evt:"mouseup"},{sel:"#tool_zoom",fn:dt,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:clickClear,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){oe?Xt():Ot()},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:Rt,evt:"mouseup"},{sel:"#tool_open",fn:zt,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:Gt,evt:"mouseup"},{sel:"#tool_source",fn:de,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:qt,evt:"click",key:["F",!0]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:nn,evt:"click",key:["esc",!1,!1],hidekey:!0},{sel:"#tool_source_save",fn:Xt,evt:"click"},{sel:"#tool_docprops_save",fn:$t,evt:"click"},{sel:"#tool_docprops",fn:Qt,evt:"mouseup"},{sel:"#tool_prefs_save",fn:en,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return Zt(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:ht,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:Ct,evt:"click"},{sel:"#tool_node_link",fn:Tt,evt:"click"},{sel:"#tool_node_clone",fn:Et,evt:"click"},{sel:"#tool_node_delete",fn:Nt,evt:"click"},{sel:"#tool_openclose_path",fn:At,evt:"click"},{sel:"#tool_add_subpath",fn:Pt,evt:"click"},{sel:"#tool_move_top",fn:yt,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:bt,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:xt,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:St,evt:"click"},{sel:"#tool_undo",fn:jt,evt:"click",key:["Z",!0]},{sel:"#tool_redo",fn:Bt,evt:"click",key:["Y",!0]},{sel:"#tool_clone,#tool_clone_multi",fn:Vt,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:Wt,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:Wt,evt:"click"},{sel:"#tool_unlink_use",fn:Wt,evt:"click"},{sel:"[id^=tool_align]",fn:Ht,evt:"click"},{sel:"#tool_bold",fn:Ft,evt:"mousedown"},{sel:"#tool_italic",fn:Mt,evt:"mousedown"},{sel:"#sidepanel_handle",fn:bn,key:["X"]},{sel:"#copy_save_done",fn:nn,evt:"click"},{key:"ctrl+left",fn:function(){Ut(0,1)}},{key:"ctrl+right",fn:function(){Ut(1,1)}},{key:"ctrl+shift+left",fn:function(){Ut(0,5)}},{key:"ctrl+shift+right",fn:function(){Ut(1,5)}},{key:"shift+O",fn:Dt},{key:"shift+P",fn:It},{key:[z+"up",!0],fn:function(){ft(2)}},{key:[z+"down",!0],fn:function(){ft(.5)}},{key:[z+"]",!0],fn:function(){kt("Up")}},{key:[z+"[",!0],fn:function(){kt("Down")}},{key:["up",!0],fn:function(){Lt(0,-1)}},{key:["down",!0],fn:function(){Lt(0,1)}},{key:["left",!0],fn:function(){Lt(-1,0)}},{key:["right",!0],fn:function(){Lt(1,0)}},{key:"shift+up",fn:function(){Lt(0,-10)}},{key:"shift+down",fn:function(){Lt(0,10)}},{key:"shift+left",fn:function(){Lt(-10,0)}},{key:"shift+right",fn:function(){Lt(10,0)}},{key:["alt+up",!0],fn:function(){r.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){r.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){r.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){r.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){r.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){r.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){r.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){r.cloneSelectedElements(10,0)}},{key:"A",fn:function(){r.selectAllInCurrentLayer()}},{key:z+"z",fn:jt},{key:z+"shift+z",fn:Bt},{key:z+"y",fn:Bt},{key:z+"x",fn:mt},{key:z+"c",fn:_t},{key:z+"v",fn:wt}],n={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var o={};e.each(t,function(t,i){var a;if(i.sel){if(a=e(i.sel),0==a.length)return!0;if(i.evt&&(svgedit.browser.isTouch()&&"click"===i.evt&&(i.evt="mousedown"),a[i.evt](i.fn)),i.parent&&0!=e(i.parent+"_show").length){var l=e(i.parent);l.length||(l=Me(i.parent.substr(1))),l.append(a),e.isArray(o[i.parent])||(o[i.parent]=[]),o[i.parent].push(i)}}if(i.key){var s,r=!0,c=i.fn,u=!1;if(e.isArray(i.key)?(s=i.key[0],i.key.length>1&&(u=i.key[1]),i.key.length>2&&(r=i.key[2])):s=i.key,s+="",e.each(s.split("/"),function(t,n){e(document).bind("keydown",n,function(e){return c(),u&&e.preventDefault(),!1})}),i.sel&&!i.hidekey&&a.attr("title")){var d=a.attr("title").split("[")[0]+" ("+s+")";n[s]=i.sel,a.parents("#main_menu").length||a.attr("title",d)}}}),Fe(o),e(".attr_changer, #image_url").bind("keydown","return",function(t){e(this).change(),t.preventDefault()}),e(window).bind("keydown","tab",function(e){"canvas"===Z&&(e.preventDefault(),It())}).bind("keydown","shift+tab",function(e){"canvas"===Z&&(e.preventDefault(),Dt())}),e("#tool_zoom").dblclick(pt)},setTitles:function(){e.each(n,function(t,n){var o=e(n).parents("#main_menu").length;e(n).each(function(){var n;n=o?e(this).text().split(" [")[0]:this.title.split(" [")[0];var i="";e.each(t.split("/"),function(e,t){var n=t.split("+"),o="";n.length>1&&(o=n[0]+"+",t=n[1]),i+=(e?"/":"")+o+(y["key_"+t]||t)}),o?this.lastChild.textContent=n+" ["+i+"]":this.title=n+" ["+i+"]"})})},getButtonData:function(n){var o;return e.each(t,function(e,t){t.sel===n&&(o=t)}),o}}}(),M.setAll(),s.ready(function(){var t,n=m.initTool,o=e("#tools_left, #svg_editor .tools_flyout"),i=o.find("#tool_"+n),a=o.find("#"+n);t=i.length?i:a.length?a:e("#tool_select"),t.click().mouseup(),m.wireframe&&e("#tool_wireframe").click(),m.showlayers&&bn(),e("#rulers").toggle(!!m.showRulers),m.showRulers&&(e("#show_rulers")[0].checked=!0),m.baseUnit&&e("#base_unit").val(m.baseUnit),m.gridSnapping&&(e("#grid_snapping_on")[0].checked=!0),m.snappingStep&&e("#grid_snapping_step").val(m.snappingStep),m.gridColor&&e("#grid_color").val(m.gridColor)}),e("#rect_rx").SpinButton({min:0,max:1e3,callback:Ze}),e("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,callback:Xe}),e("#angle").SpinButton({min:-180,max:180,step:5,callback:Ye}),e("#font_size").SpinButton({min:.001,
stepfunc:S,callback:Ke}),e("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Je}),e("#blur").SpinButton({min:0,max:10,step:.1,callback:$e}),e("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:L,callback:F}).val(100*r.getZoom()),e("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(e,t,n){switch(e){case"interactivity":break;case"delete":ht();break;case"deselect":var o=r.getMode();r.clearSelection(),r.setMode(o);break;case"cut":mt();break;case"copy":_t();break;case"paste":r.pasteElements();break;case"paste_in_place":r.pasteElements("in_place");break;case"group":case"group_elements":r.groupSelectedElements();break;case"ungroup":r.ungroupSelectedElement();break;case"move_front":yt();break;case"move_up":kt("Up");break;case"move_down":kt("Down");break;case"move_back":bt();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(e)&&svgedit.contextmenu.getCustomHandler(e).call()}r.clipBoard.length&&V.enableContextMenuItems("#paste,#paste_in_place")});var xn=function(e,t,n){switch(e){case"dupe":k();break;case"delete":b();break;case"merge_down":x();break;case"merge_all":r.mergeAllLayers(),ke(),ue()}};if(e("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},xn),e("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},xn),e(".contextMenu li").mousedown(function(e){e.preventDefault()}),e("#cmenu_canvas li").disableContextMenu(),V.enableContextMenuItems("#delete,#deselect,#cut,#copy"),window.addEventListener("beforeunload",function(e){if(0===j.getUndoStackSize()&&(s.showSaveWarning=!1),!m.no_save_warning&&s.showSaveWarning)return e.returnValue=y.notification.unsavedChanges,y.notification.unsavedChanges},!1),s.openPrep=function(t){e("#main_menu").hide(),0===j.getUndoStackSize()?t(!0):e.confirm(y.notification.QwantToOpen,t)},window.FileReader){var Cn=function(t){e.process_cancel(y.notification.loadingImage),t.stopPropagation(),t.preventDefault(),e("#workarea").removeAttr("style"),e("#main_menu").hide();var n="drop"==t.type?t.dataTransfer.files[0]:this.files[0];if(!n)return void e("#dialog_box").hide();if(n.type.indexOf("image")!=-1){var o;n.type.indexOf("svg")!=-1?(o=new FileReader,o.onloadend=function(t){r.importSvgString(t.target.result,!0),r.ungroupSelectedElement(),r.ungroupSelectedElement(),r.groupSelectedElements(),r.alignSelectedElements("m","page"),r.alignSelectedElements("c","page"),e("#dialog_box").hide()},o.readAsText(n)):(o=new FileReader,o.onloadend=function(t){var n=function(n,o){var i=r.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:n,height:o,id:r.getNextId(),style:"pointer-events:inherit"}});r.setHref(i,t.target.result),r.selectOnly([i]),r.alignSelectedElements("m","page"),r.alignSelectedElements("c","page"),ke(),e("#dialog_box").hide()},o=100,i=100,a=new Image;a.src=t.target.result,a.style.opacity=0,a.onload=function(){o=a.offsetWidth,i=a.offsetHeight,n(o,i)}},o.readAsDataURL(n))}};W[0].addEventListener("dragenter",T,!1),W[0].addEventListener("dragover",E,!1),W[0].addEventListener("dragleave",N,!1),W[0].addEventListener("drop",Cn,!1);var Sn=e('<input type="file">').change(function(){var t=this;s.openPrep(function(n){if(n&&(r.clear(),1===t.files.length)){e.process_cancel(y.notification.loadingImage);var o=new FileReader;o.onloadend=function(e){l(e.target.result),we()},o.readAsText(t.files[0])}})});e("#tool_open").show().prepend(Sn);var Ln=e('<input type="file">').change(Cn);e("#tool_import").show().prepend(Ln)}we(!0),e(function(){window.svgCanvas=r,r.ready=s.ready}),s.setLang=function(t,n){if(s.langChanged=!0,e.pref("lang",t),e("#lang_select").val(t),n){var o=e("#layerlist tr.layersel td.layername").text(),i=o==y.common.layer+" 1";if(e.extend(y,n),r.setUiStrings(n),M.setTitles(),i&&(r.renameCurrentLayer(y.common.layer+" 1"),ue()),je.length)for(;je.length;){var a=je.shift();a.langReady({lang:t,uiStrings:y})}else r.runExtensions("langReady",{lang:t,uiStrings:y});r.runExtensions("langChanged",t),De();var l={"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"};e.each(l,function(t,n){e(n).attr("title",e(t)[0].title)}),e("#multiselected_panel div[id^=tool_align]").each(function(){e("#tool_pos"+this.id.substr(10))[0].title=this.title})}},r&&r.setColor("fill","#FFFFFF")},s.ready=function(e){d?e():v.push(e)},s.runCallbacks=function(){e.each(v,function(){this()}),d=!0},s.loadFromString=function(e){s.ready(function(){l(e)})},s.disableUI=function(e){},s.loadFromURL=function(t,n){n||(n={});var o=n.cache,i=n.callback;s.ready(function(){e.ajax({url:t,dataType:"text",cache:!!o,beforeSend:function(){e.process_cancel(y.notification.loadingImage)},success:function(e){l(e,i)},error:function(t,n,o){404!=t.status&&t.responseText?l(t.responseText,i):e.alert(y.notification.URLloadFail+": \n"+o,i)},complete:function(){e("#dialog_box").hide()}})})},s.loadFromDataURI=function(e){s.ready(function(){var t=!1,n=e.match(/^data:image\/svg\+xml;base64,/);n?t=!0:n=e.match(/^data:image\/svg\+xml(?:;(?:utf8)?)?,/),n&&(n=n[0]);var o=e.slice(n.length);l(t?u.decode64(o):decodeURIComponent(o))})},s.addExtension=function(){var e=arguments;r&&(r.addExtension.apply(this,e),s&&s.extensionLoadedCallback&&s.extensionLoadedCallback(e))},s}(jQuery)}}}(mysvgeditor||{});