window.extCompressors=function(){svgEditor.addExtension("compressors",function(m){"use strict";var f,p,h=svgEditor.canvas,x="compressor",y="svg-ext-"+x,w="CPS_",b={},_={void:[{id:"v",type:"path",attr:{d:"m 10,3.3 28,8.4 m -28,26 28,-8.4 M 40,21 A 20,20 0 0 1 20,41 20,20 0 0 1 0,21 20,20 0 0 1 20,1 20,20 0 0 1 40,21 Z"}}],fan:[{id:"f",type:"path",attr:{d:"m 17.41,14.62 c 2.15,2.52 3.49,4.91 2.99,5.34 -0.24,0.21 -0.88,-0.07 -1.79,-0.78 -0.9,-0.71 -1.99,-1.79 -3.02,-3 -2.15,-2.52 -3.49,-4.91 -2.99,-5.34 0.24,-0.21 0.88,0.07 1.79,0.78 0.9,0.71 1.99,1.79 3.02,3 z m -1.83,9.27 c 1.03,-1.22 2.11,-2.3 3,-3.02 0.9,-0.72 1.54,-1 1.78,-0.79 0.25,0.2 0.08,0.88 -0.48,1.88 -0.55,1.01 -1.43,2.26 -2.46,3.48 -1.03,1.22 -2.11,2.31 -3,3.02 -0.9,0.72 -1.54,1 -1.78,0.8 -0.25,-0.21 -0.08,-0.89 0.48,-1.89 0.55,-1.01 1.43,-2.26 2.46,-3.48 z M 33,20 A 6,1.2 0 0 1 27,21.2 6,1.2 0 0 1 21,20 6,1.2 0 0 1 27,18.8 6,1.2 0 0 1 33,20 M 10.5,2.8 l 28,8.4 m -28,26 28,-8.4 M 41,20 A 20,20 0 0 1 21,40 20,20 0 0 1 1,20 20,20 0 0 1 21,0 20,20 0 0 1 41,20 Z"}}],piston:[{id:"p",type:"path",attr:{d:"m 10,2.8 28,8.4 m -28,26 28,-8.4 M 14,20 h 12 m 0,-6 V 26 M 40,20 A 20,20 0 0 1 20,40 20,20 0 0 1 0,20 20,20 0 0 1 20,0 20,20 0 0 1 40,20 Z"}}]};return{callback:function(){$("#compressor_panel").hide()},mouseDown:function(t){var e=h.getMode();if(e.substr(0,x.length)===x){var r=h.getColor("fill"),n=h.getColor("stroke"),o=h.getStrokeWidth();h.getStyle();r===n&&(r="#FFFFFF",n="#000000");var i=e.substr((x+"-").length);_[i];for(var a=t.start_x,s=t.start_y-35,l={fill:r,stroke:n,"font-size":h.getFontSize(),"font-family":h.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},d={elements:[]},g=0;g<_[i].length;g++){var c=_[i][g],v={id:c.id+h.getNextId().replace("svg_",w),"stroke-width":o};$.extend(v,c.attr),d.elements.push({type:c.type,attr:v})}var u={type:y,x:a,y:s,style:"pointer-events:none"};return $.extend(u,l),b.x=a,b.y=s,f=h.getNextId().replace("svg_",w),(p=m.addSvgGroupFromJson({group:"g",id:f,type:y,attr:u,elements:d.elements})).setAttribute("transform","translate("+a+","+s+")"),h.recalculateDimensions(p),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(h.getMode().substr(0,x.length)===x)return{keep:t.event.clientX!=b.x&&t.event.clientY!=b.y,element:p,started:!1}},getClassId:function(){return y}}})},window.extConnector=function(){window.svgEditor&&svgEditor.addExtension("Connector",function(t){var v,u,m,f,p,h,x=t.svgcontent,c=t.svgroot,d=t.getNextId,y=t.getElem,w=t.addSvgElementFromJson,b=t.selectorManager,g=svgEditor.curConfig,_=!1,k=[],C=".se_connector",M=[],S=$.data,e={en:[{id:"mode_connect",title:"Connect two objects"}],fr:[{id:"mode_connect",title:"Connecter deux objets"}]};function E(t,e,r,n){n&&(n-=0,(r=$.extend({},r)).width+=n,r.height+=n,r.x-=n/2,r.y-=n/2);var o,i=r.x+r.width/2,a=r.y+r.height/2,s=t-i,l=e-a;return{x:i+s*(o=Math.abs(l/s)<r.height/r.width?r.width/2/Math.abs(s):r.height/2/Math.abs(l)),y:a+l*o}}function A(t,e){var r=!!e.getAttribute("marker-"+t),n=5*e.getAttribute("stroke-width");return r?n:0}function n(t){var e=$("#connector_rules");e.length||(e=$('<style id="connector_rules"></style>').appendTo("head")),e.text(t?"#tool_clone, #tool_topath, #tool_angle, #xy_panel { display: none !important; }":""),$("#connector_panel").toggle(t)}function F(e,r,n,o,t){var i,a=e.points,s=c.createSVGPoint();s.x=n,s.y=o,"end"===r&&(r=a.numberOfItems-1);try{a.replaceItem(s,r)}catch(t){var l=e.getAttribute("points").split(" ");for(i=0;i<l.length;i++)i===r&&(l[i]=n+","+o);e.setAttribute("points",l.join(" "))}if(t){var d=a.getItem(0),g=a.getItem(a.numberOfItems-1);F(e,1,(g.x+d.x)/2,(g.y+d.y)/2)}}function I(s){var l;s||(s=M);var t=$(x).find(C);k=[],t.each(function(){var t;function e(){-1!==$.inArray(this,s)&&(t=!0)}var r=S(this,"c_start"),n=S(this,"c_end"),o=[y(r),y(n)];for(l=0;l<2;l++){var i=o[l];if(t=!1,$(i).parents().each(e),i&&i.parentNode){if(-1!==$.inArray(i,s)||t){var a=svgCanvas.getStrokedBBox([i]);k.push({elem:i,connector:this,is_start:0===l,start_x:a.x,start_y:a.y})}}else $(this).remove()}})}function N(t){var e,r;if(I(t),k.length)for(e=k.length;e--;){var n=k[e],o=n.connector,i=n.elem,a=(o.getAttribute("stroke-width"),n.is_start?"start":"end"),s=svgCanvas.getStrokedBBox([i]);s.x=n.start_x,s.y=n.start_y,S(o,a+"_bb",s);S(o,a+"_off");var l=n.is_start?"end":"start",d=S(o,l+"_bb"),g=E(d.x+d.width/2,d.y+d.height/2,s,A(a,o));F(o,n.is_start?0:"end",g.x,g.y,!0);var c=E(g.x,g.y,S(o,l+"_bb"),A(l,o));if(F(o,n.is_start?"end":0,c.x,c.y,!0),-1!==navigator.userAgent.indexOf("AppleWebKit")){var v=o.points,u=v.numberOfItems,m=[];for(r=0;r<u;r++)g=v.getItem(r),m[r]=g.x+","+g.y;o.setAttribute("points",m.join(" "))}}}return function(){var t=svgCanvas.groupSelectedElements;svgCanvas.groupSelectedElements=function(){return svgCanvas.removeFromSelection($(C).toArray()),t.apply(this,arguments)};var e=svgCanvas.moveSelectedElements;svgCanvas.moveSelectedElements=function(){svgCanvas.removeFromSelection($(C).toArray());var t=e.apply(this,arguments);return N(),t},h=svgCanvas.getEditorNS()}(),{name:"Connector",buttons:[{id:"mode_connect",type:"mode",title:"Connect two objects",includeWith:{button:"#tool_line",isDefault:!1,position:1},events:{click:function(){svgCanvas.setMode("connector")}}}],addLangData:function(t){return{data:e[t]}},mouseDown:function(t){var e=t.event;v=t.start_x,u=t.start_y;var r=svgCanvas.getMode();if("connector"==r){if(_)return;var n=e.target,o=$(n).parents();if(-1!==$.inArray(x,o)){var i=$(n).closest("foreignObject");f=i.length?i[0]:n;var a=svgCanvas.getStrokedBBox([f]),s=a.x+a.width/2,l=a.y+a.height/2;_=!0,m=w({element:"polyline",attr:{id:d(),points:s+","+l+" "+s+","+l+" "+v+","+u,stroke:"#"+g.initStroke.color,"stroke-width":f.stroke_width&&0!=f.stroke_width?f.stroke_width:g.initStroke.width,fill:"none",opacity:g.initStroke.opacity,style:"pointer-events:none"}}),S(m,"start_bb",a)}return{started:!0}}"select"==r&&I()},mouseMove:function(t){var e=svgCanvas.getZoom(),r=(t.event,t.mouse_x/e),n=t.mouse_y/e,o=r-v,i=n-u,a=svgCanvas.getMode();if("connector"==a&&_){m.getAttribute("stroke-width");var s=E(r,n,S(m,"start_bb"),A("start",m));v=s.x,u=s.y,F(m,0,s.x,s.y,!0),F(m,"end",r,n,!0)}else if("select"==a){for(var l=M.length;l--;){var d=M[l];d&&S(d,"c_start")&&(svgCanvas.removeFromSelection([d]),svgCanvas.getTransformList(d).clear())}k.length&&function(t,e){for(var r=k.length;r--;){var n=k[r],o=n.connector,i=(n.elem,n.is_start?"start":"end"),a=S(o,i+"_bb");a.x=n.start_x+t,a.y=n.start_y+e,S(o,i+"_bb",a);var s=n.is_start?"end":"start",l=S(o,s+"_bb"),d=E(l.x+l.width/2,l.y+l.height/2,a,A(i,o));F(o,n.is_start?0:"end",d.x,d.y,!0);var g=E(d.x,d.y,S(o,s+"_bb"),A(s,o));F(o,n.is_start?"end":0,g.x,g.y,!0)}}(o,i)}},mouseUp:function(t){var e=svgCanvas.getZoom(),r=t.event,n=(t.mouse_x,t.mouse_y,r.target);if("connector"==svgCanvas.getMode()){var o=$(n).closest("foreignObject");o.length&&(n=o[0]);var i=$(n).parents();if(n==f)return{keep:_=!0,element:null,started:_};if(-1===$.inArray(x,i))return $(m).remove(),{keep:_=!1,element:null,started:_};p=n;var a=f.id,s=p.id,l=a+" "+s,d=s+" "+a;if($(x).find(C).filter(function(){var t=this.getAttributeNS(h,"connector");if(t==l||t==d)return!0}).length)return $(m).remove(),{keep:!1,element:null,started:!1};var g=svgCanvas.getStrokedBBox([p]),c=E(v,u,g,A("start",m));return F(m,"end",c.x,c.y,!0),$(m).data("c_start",a).data("c_end",s).data("end_bb",g),h=svgCanvas.getEditorNS(!0),m.setAttributeNS(h,"se:connector",l),m.setAttribute("class",C.substr(1)),m.setAttribute("opacity",1),svgCanvas.addToSelection([m]),svgCanvas.moveToBottomSelectedElement(),b.requestSelector(m).showGrips(!1),{keep:!(_=!1),element:m,started:_}}},selectedChanged:function(t){if($(x).find(C).length){"connector"==svgCanvas.getMode()&&svgCanvas.setMode("select");for(var e=(M=t.elems).length;e--;){var r=M[e];r&&S(r,"c_start")?(b.requestSelector(r).showGrips(!1),t.selectedElement&&!t.multiselected?n(!0):n(!1)):n(!1)}N()}},elementChanged:function(t){var e,r=t.elems[0];if(r&&"svg"===r.tagName&&"svgcontent"===r.id&&(x=r,$(x).find("*").each(function(){var t=this.getAttributeNS(h,"connector");if(t){this.setAttribute("class",C.substr(1));var e=t.split(" "),r=svgCanvas.getStrokedBBox([y(e[0])]),n=svgCanvas.getStrokedBBox([y(e[1])]);$(this).data("c_start",e[0]).data("c_end",e[1]).data("start_bb",r).data("end_bb",n),svgCanvas.getEditorNS(!0)}})),r&&(r.getAttribute("marker-start")||r.getAttribute("marker-mid")||r.getAttribute("marker-end"))){e=r.getAttribute("marker-start");var n=r.getAttribute("marker-mid"),o=r.getAttribute("marker-end");if(m=r,$(r).data("start_off",!!e).data("end_off",!!o),"line"===r.tagName&&n){var i=Number(r.getAttribute("x1")),a=Number(r.getAttribute("x2")),s=Number(r.getAttribute("y1")),l=Number(r.getAttribute("y2")),d=r.id,g=w({element:"polyline",attr:{points:i+","+s+(" "+(i+a)/2+","+(s+l)/2+" ")+a+","+l,stroke:r.getAttribute("stroke"),"stroke-width":r.getAttribute("stroke-width"),"marker-mid":n,fill:"none",opacity:r.getAttribute("opacity")||1}});$(r).after(g).remove(),svgCanvas.clearSelection(),g.id=d,svgCanvas.addToSelection([g]),r=g}}r.getAttribute("class")==C.substr(1)?N([e=y(S(r,"c_start"))]):N()},toolButtonStateUpdate:function(t){t.nostroke&&$("#mode_connect").hasClass("tool_button_current")&&svgEditor.clickSelect(),$("#mode_connect").toggleClass("disabled",t.nostroke)}}})},window.extEyedropper=function(){window.svgEditor&&svgEditor.addExtension("eyedropper",function(t){"use strict";var i=svgEditor.canvas,a=svgedit.history.ChangeElementCommand,s={fillPaint:"red",fillOpacity:1,strokePaint:"black",strokeOpacity:1,strokeWidth:5,strokeDashArray:null,opacity:1,strokeLinecap:"butt",strokeLinejoin:"miter"};function e(t){if("eyedropper"!=i.getMode()){var e=null,r=$("#tool_eyedropper");!t.multiselected&&t.elems[0]&&-1===$.inArray(t.elems[0].nodeName,["svg","g","use"])?(e=t.elems[0],r.removeClass("disabled"),s.fillPaint=e.getAttribute("fill")||"black",s.fillOpacity=e.getAttribute("fill-opacity")||1,s.strokePaint=e.getAttribute("stroke"),s.strokeOpacity=e.getAttribute("stroke-opacity")||1,s.strokeWidth=e.getAttribute("stroke-width"),s.strokeDashArray=e.getAttribute("stroke-dasharray"),s.strokeLinecap=e.getAttribute("stroke-linecap"),s.strokeLinejoin=e.getAttribute("stroke-linejoin"),s.opacity=e.getAttribute("opacity")||1):r.addClass("disabled")}}return{name:"eyedropper",buttons:[{id:"tool_eyedropper",type:"mode",title:"Eye Dropper Tool",key:"I",events:{click:function(){i.setMode("eyedropper")}}}],selectedChanged:e,elementChanged:e,mouseDown:function(t){var e;if("eyedropper"==i.getMode()){var r=t.event.target;if(-1===$.inArray(r.nodeName,["svg","g","use"])){var n={},o=function(t,e,r){n[e]=t.getAttribute(e),t.setAttribute(e,r)};s.fillPaint&&o(r,"fill",s.fillPaint),s.fillOpacity&&o(r,"fill-opacity",s.fillOpacity),s.strokePaint&&o(r,"stroke",s.strokePaint),s.strokeOpacity&&o(r,"stroke-opacity",s.strokeOpacity),s.strokeWidth&&o(r,"stroke-width",s.strokeWidth),s.strokeDashArray&&o(r,"stroke-dasharray",s.strokeDashArray),s.opacity&&o(r,"opacity",s.opacity),s.strokeLinecap&&o(r,"stroke-linecap",s.strokeLinecap),s.strokeLinejoin&&o(r,"stroke-linejoin",s.strokeLinejoin),e=new a(r,n),i.undoMgr.addCommandToHistory(e)}}}}})},window.extGrid=function(){window.svgEditor&&svgEditor.addExtension("view_grid",function(){"use strict";var t=svgedit.NS,c=svgEditor.canvas,e=document.getElementById("svgcanvas").ownerDocument,r=svgEditor.curConfig.showGrid||!1,n=c.assignAttributes,v=document.createElement("canvas"),o=$("#canvasBackground"),u=svgedit.units.getTypeMap(),m=[.01,.1,1,10,100,1e3];$(v).hide().appendTo("body");var i=e.createElementNS(t.SVG,"svg");n(i,{id:"canvasGrid",width:"100%",height:"100%",x:0,y:0,overflow:"visible",display:"none"}),o.append(i);var a=e.createElementNS(t.SVG,"pattern");n(a,{id:"gridpattern",patternUnits:"userSpaceOnUse",x:0,y:0,width:100,height:100});var f=e.createElementNS(t.SVG,"image");n(f,{x:0,y:0,width:100,height:100}),a.appendChild(f),$("#svgroot defs").append(a);var s=e.createElementNS(t.SVG,"rect");function l(t){var e,r=u[svgEditor.curConfig.baseUnit]*t,n=100/r,o=1;for(e=0;e<m.length;e++){var i=m[e];if(n<=(o=i))break}var a=o*r;v.width=a,v.height=a;var s=v.getContext("2d"),l=a/10;for(s.globalAlpha=.2,s.strokeStyle=svgEditor.curConfig.gridColor,e=1;e<10;e++){var d=Math.round(l*e)+.5;s.moveTo(d,a),s.lineTo(d,0),s.moveTo(a,d),s.lineTo(0,d)}s.stroke(),s.beginPath(),s.globalAlpha=.5,s.moveTo(.5,a),s.lineTo(.5,0),s.moveTo(a,.5),s.lineTo(0,.5),s.stroke();var g=v.toDataURL("image/png");f.setAttribute("width",a),f.setAttribute("height",a),f.parentNode.setAttribute("width",a),f.parentNode.setAttribute("height",a),c.setHref(f,g)}function d(){r&&l(c.getZoom()),$("#canvasGrid").toggle(r)}return n(s,{width:"100%",height:"100%",x:0,y:0,"stroke-width":0,stroke:"none",fill:"url(#gridpattern)",style:"pointer-events: none; display:visible;"}),$("#canvasGrid").append(s),{name:"view_grid",zoomChanged:function(t){r&&l(t)},callback:function(){r&&d()},buttons:[{id:"view_grid",events:{click:function(){svgEditor.curConfig.showGrid=r=!r,d()}}}]}})},window.extMarkers=function(){window.svgEditor&&svgEditor.addExtension("Markers",function(p){var h,x=p.addSvgElementFromJson,d=["start","mid","end"],g="se_marker_",y={nomarker:{label:"&#x2014;"},leftarrow:{element:"path",attr:{d:"M0,50 L100,90 L70,50 L100,10 Z"},label:"&#x25C4;"},rightarrow:{element:"path",attr:{d:"M100,50 L0,90 L30,50 L0,10 Z"},label:"&#x25BA;"},leftpointing:{element:"path",attr:{d:"M50,48 L90,90 M50,52 L90,10"},label:"&#x2009;&#x02C2;"},rightpointing:{element:"path",attr:{d:"M50,48 L10,90 L50,52 L10,10 Z"},label:"&#x2009;&#x003E;"},break:{element:"path",attr:{d:"M50,20 L50,80"},label:"&#x2009;&#x2223;"},mcircle:{element:"circle",attr:{r:30,cx:50,cy:50},label:"&#x2009;&#x25CF;"}};function c(t,e){var r=t.getAttribute(e);if(!r)return null;var n=r.match(/\(\#(.*)\)/);return n&&2===n.length?p.getElem(n[1]):null}function s(t,r){"\\"!==r.substr(0,1)&&(r="\\textmarker");var e=document.getElementById(t+"_marker"),n=0;$.each(y,function(t,e){if(-1!==r.indexOf(t))return!1;n++}),e.selectedIndex=n}function o(t){if($("#marker_panel").toggle(t),t){var o,i,a=h[0];$.each(d,function(t,e){var r=c(a,"marker-"+e),n=$("#"+e+"_marker");if(r){if(!r.attributes.se_type)return;o="\\"+r.attributes.se_type.textContent,"\\textmarker"===(i=o)?o=r.lastChild.textContent:n.hide()}else i=o="\\nomarker",n.hide();n.val(o),s(e,i)})}}function v(t,e){var r=p.getElem(t);if(!r&&""!=e&&"\\nomarker"!=e){var n,o=h[0].getAttribute("stroke"),i=50,a=50,s="0 0 100 100",l=10,d=10;if(n="\\"===e.substr(0,1)?e.substr(1):"textmarker",y[n]){if(r=x({element:"marker",attr:{id:t,orient:"auto",style:"pointer-events:none",se_type:n}}),"textmarker"!=n){var g=x(y[n]),c=o;"_o"===n.substr(-2)&&(c="none"),g.setAttribute("fill",c),g.setAttribute("stroke",o),g.setAttribute("stroke-width",10),r.appendChild(g)}else{var v=x(y[n]);v.textContent=e;var u=v.getBBox(),m=u;m.x=0,m.y=0,m.width+=2,m.height+=2,v.setAttribute("x",1),v.setAttribute("y",m.height-1-u.height/4),v.setAttribute("fill",o),i=m.width/2+1,a=m.height/2+1,s=m.x+" "+m.y+" "+m.width+" "+m.height,l=m.width/10,d=m.height/10;var f=x({element:"rect",attr:{x:m.x,y:m.y,width:m.width,height:m.height,fill:"#ffffff",stroke:"none","stroke-width":0}});r.setAttribute("orient",0),r.appendChild(f),r.appendChild(v)}return r.setAttribute("viewBox",s),r.setAttribute("markerWidth",l),r.setAttribute("markerHeight",d),r.setAttribute("refX",i),r.setAttribute("refY",a),p.findDefs().appendChild(r),r}}}function u(n){if("line"!==n.tagName)return n;var t=Number(n.getAttribute("x1")),e=Number(n.getAttribute("x2")),r=Number(n.getAttribute("y1")),o=Number(n.getAttribute("y2")),i=n.id,a=x({element:"polyline",attr:{points:t+","+r+(" "+(t+e)/2+","+(r+o)/2+" ")+e+","+o,stroke:n.getAttribute("stroke"),"stroke-width":n.getAttribute("stroke-width"),fill:"none",opacity:n.getAttribute("opacity")||1}});$.each(d,function(t,e){var r="marker-"+e;n.getAttribute(r)&&a.setAttribute(r,n.getAttribute(r))});var s=new p.BatchCommand;return s.addSubCommand(new p.RemoveElementCommand(n,n.parentNode)),s.addSubCommand(new p.InsertElementCommand(a)),$(n).after(a).remove(),svgCanvas.clearSelection(),a.id=i,svgCanvas.addToSelection([a]),p.addCommandToHistory(s),a}return{name:"Markers",mySetMarker:function(t,r){var n=void 0,o=0;$.each(y,function(t,e){r===o++&&(n=t)}),function(t,e){var r={start_marker:"start",mid_marker:"mid",end_marker:"end"}[t],n="marker-"+r,o=e,i=h[0],a=c(i,n);if(a&&$(a).remove(),i.removeAttribute(n),""==o&&(o="\\nomarker"),"\\nomarker"==o)return s(r,o),p.call("changed",h);v(t=g+r+"_"+i.id,o),svgCanvas.changeSelectedAttribute(n,"url(#"+t+")"),"line"===i.tagName&&"mid"==r&&(i=u(i)),p.call("changed",h),s(r,o)}(t,"\\"+n)},callback:function(){var a=document.getElementById("start_marker"),s=document.getElementById("mid_marker"),l=document.getElementById("end_marker");$.each(y,function(t,e){if(e.label){var r=document.createElement("option");r.value=e.label,r.innerHTML=e.label,r.setAttribute("style","background-color: rgba(33,33,33,1);color: rgba(255,255,255,1);");var n=r.cloneNode(!0),o=r.cloneNode(!0),i=r.cloneNode(!0);a.appendChild(n),s.appendChild(o),l.appendChild(i)}})},selectedChanged:function(t){for(var e=(h=t.elems).length,r=["line","path","polyline"];e--;){var n=h[e];n&&-1!==$.inArray(n.tagName,r)&&t.selectedElement&&!t.multiselected?o(!0):o(!1)}},elementChanged:function(t){var l,a,s,e=t.elems[0];if(e&&(e.getAttribute("marker-start")||e.getAttribute("marker-mid")||e.getAttribute("marker-end"))){s=(a=e).getAttribute("stroke"),$.each(d,function(t,e){var r=c(a,"marker-"+e);if(r&&r.attributes.se_type){var n=r.lastElementChild;if(n){var o=n.getAttribute("fill"),i=n.getAttribute("stroke");o&&"none"!=o&&n.setAttribute("fill",s),i&&"none"!=i&&n.setAttribute("stroke",s)}}}),l=e,$.each(d,function(t,e){var r=g+e+"_"+l.id,n="marker-"+e,o=c(l,n);if(o&&o.attributes.se_type){var i=l.getAttribute(n);if(i){var a=l.id.length,s=i.substr(-a-1,a);l.id!=s&&(v(r,$("#"+e+"_marker").attr("value")),svgCanvas.changeSelectedAttribute(n,"url(#"+r+")"),"line"===l.tagName&&"mid"==e&&(l=u(l)),p.call("changed",h))}}});e&&-1!==$.inArray(e.tagName,["line","path","polyline"])&&o(!0)}}}})},window.extOverview=function(){if(window.svgEditor){var e={};svgEditor.addExtension("overview_window",function(){"use strict";$("#sidepanels").append('\t\t<div id="overview_window_content_pane" style=" width:100%; word-wrap:break-word;  display:inline-block; margin-top:20px;">\t\t\t<div id="overview_window_content" style="position:relative; left:12px; top:0px;">\t\t\t\t<div style="background-color:#A0A0A0; display:inline-block; overflow:visible;">\t\t\t\t\t<svg id="overviewMiniView" width="150" height="100" x="0" y="0" viewBox="0 0 4800 3600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\t\t\t\t\t\t<use x="0" y="0" xlink:href="#svgroot"> </use>\t\t\t\t\t </svg>\t\t\t\t\t <div id="overview_window_view_box" style="min-width:50px; min-height:50px; position:absolute; top:30px; left:30px; z-index:5; background-color:rgba(255,0,102,0.3);">\t\t\t\t\t </div>\t\t\t\t </div>\t\t\t</div>\t\t</div>');var i=function(){var t=parseFloat($("#workarea").css("height")),e=parseFloat($("#workarea").css("width")),r=$("#workarea").scrollLeft(),n=$("#workarea").scrollTop(),o=parseFloat($("#svgcanvas").css("width")),i=parseFloat($("#svgcanvas").css("height")),a=$("#overviewMiniView").attr("width"),s=$("#overviewMiniView").attr("height"),l=r/o*a,d=n/i*s,g=e/o*a,c=t/i*s;$("#overview_window_view_box").css("min-width",g+"px"),$("#overview_window_view_box").css("min-height",c+"px"),$("#overview_window_view_box").css("top",d+"px"),$("#overview_window_view_box").css("left",l+"px")};$("#workarea").scroll(function(){e.viewBoxDragging||i()}),$("#workarea").resize(i),i();var t=function(){var t=$("#svgroot").attr("width"),e=$("#svgroot").attr("height"),r=640,n=480;svgedit.browser.isIE()&&(n=r=0);var o=e/t*$("#overviewMiniView").attr("width");$("#overviewMiniView").attr("viewBox",r+" "+n+" "+t+" "+e),$("#overviewMiniView").attr("height",o),i()};t(),e.viewBoxDragging=!1;var d=function(){var t=parseFloat($("#svgcanvas").css("width")),e=parseFloat($("#svgcanvas").css("height")),r=$("#overviewMiniView").attr("width"),n=$("#overviewMiniView").attr("height"),o=parseFloat($("#overview_window_view_box").css("left"))/r*t,i=parseFloat($("#overview_window_view_box").css("top"))/n*e;$("#workarea").scrollLeft(o),$("#workarea").scrollTop(i)};return $("#overview_window_view_box").draggable({containment:"parent",drag:d,start:function(){e.viewBoxDragging=!0},stop:function(){e.viewBoxDragging=!1}}),$("#overviewMiniView").click(function(t){var e=t.offsetX||t.originalEvent.layerX,r=t.offsetY||t.originalEvent.layerY,n=$("#overviewMiniView").attr("width"),o=$("#overviewMiniView").attr("height"),i=parseFloat($("#overview_window_view_box").css("min-width")),a=parseFloat($("#overview_window_view_box").css("min-height")),s=e-.5*i,l=r-.5*a;s<0&&(s=0),l<0&&(l=0),n<s+i&&(s=n-i),o<l+a&&(l=o-a),$("#overview_window_view_box").css("top",l+"px"),$("#overview_window_view_box").css("left",s+"px"),d()}),{name:"overview window",canvasUpdated:t,workareaResized:i}})}},window.extPanning=function(){window.svgEditor&&svgEditor.addExtension("ext-panning",function(){"use strict";return{name:"Extension Panning",buttons:[{id:"ext-panning",type:"mode",title:"Panning",events:{click:function(){svgCanvas.setMode("ext-panning")}}}],mouseDown:function(){if("ext-panning"==svgCanvas.getMode())return svgEditor.setPanning(!0),{started:!0}},mouseUp:function(){if("ext-panning"==svgCanvas.getMode())return svgEditor.setPanning(!1),{keep:!1,element:null}}}})},window.extStorage=function(){window.svgEditor&&svgEditor.addExtension("storage",function(){var l=svgEditor.curConfig.emptyStorageOnDecline,d=svgEditor.curConfig.noStorageOnLoad,g=svgEditor.curConfig.forceStorage,c=svgEditor.storage;function v(n){n=n?"storagePrompt="+n:"";var t=top.location;-1<t.href.indexOf("storagePrompt=")?t.href=t.href.replace(/([&?])storagePrompt=[^&]*(&?)/,function(t,e,r){return(n?e:"")+n+(!n&&r?e:r||"")}):t.href+=(-1<t.href.indexOf("?")?"&":"?")+n}function u(t){if(c){var e="svgedit-"+svgEditor.curConfig.canvasName;t?c.setItem(e,t):c.removeItem(e)}}function m(t){document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"}function f(){window.addEventListener("beforeunload",function(t){if(document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){var e;document.cookie.match(/(?:^|;\s*)store=prefsAndContent/)&&u(svgCanvas.getSvgString()),svgEditor.setConfig({no_save_warning:!0});var r=svgEditor.curPrefs;for(e in r)if(r.hasOwnProperty(e)){var n=r[e];if(e="web-edit-"+e,!(null!=n))continue;c?c.setItem(e,n):window.widget?widget.setPreferenceForKey(n,e):(n=encodeURIComponent(n),document.cookie=encodeURIComponent(e)+"="+n+"; expires=Fri, 31 Dec 9999 23:59:59 GMT")}}},!1)}var p=!1;return{name:"storage",langReady:function(t){var e=t.uiStrings,r=$.deparam.querystring(!0).storagePrompt;if(!p)if(p=!0,g||!0!==r&&(!1===r||document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))d&&!g||f();else{var n=[];c?n.unshift({value:"prefsAndContent",text:e.confirmSetStorage.storagePrefsAndContent},{value:"prefsOnly",text:e.confirmSetStorage.storagePrefsOnly},{value:"noPrefsOrContent",text:e.confirmSetStorage.storageNoPrefsOrContent}):n.unshift({value:"prefsOnly",text:e.confirmSetStorage.storagePrefs},{value:"noPrefsOrContent",text:e.confirmSetStorage.storageNoPrefs});var o=$("#dialog_container")[0].style.width,i=$("#dialog_container")[0].style.marginLeft,a=$("#dialog_content")[0].style.height,s=$("#dialog_container")[0].style.height;$("#dialog_content")[0].style.height="120px",$("#dialog_container")[0].style.height="170px",$("#dialog_container")[0].style.width="800px",$("#dialog_container")[0].style.marginLeft="-400px",$.select(e.confirmSetStorage.message,n,function(t,e){if(t&&"noPrefsOrContent"!==t){if(document.cookie="store="+encodeURIComponent(t)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT",!0===r&&e)return void v()}else if(m("store"),t&&l&&function(){var t;for(t in u(""),svgEditor.curPrefs)svgEditor.curPrefs.hasOwnProperty(t)&&(t="web-edit-"+t,c&&c.removeItem(t),m(t))}(),t&&e)return void v("false");$("#dialog_container")[0].style.width=o,$("#dialog_container")[0].style.marginLeft=i,$("#dialog_content")[0].style.height=a,$("#dialog_container")[0].style.height=s,f(),svgEditor.storagePromptClosed=!0},null,null,{label:e.confirmSetStorage.rememberLabel,checked:!1,tooltip:e.confirmSetStorage.rememberTooltip})}}}})},window.extSwitch=function(){svgEditor.addExtension("switch",function(k){"use strict";var g,C,M,S,E=svgEditor.canvas,A=E.getRootElem(),F={},I="switch",c="svg-ext-"+I,v="SWI_",u={};return{callback:function(){$("#switch_panel").hide()},mouseDown:function(t){var e=E.getColor("fill"),r=E.getColor("stroke"),n=E.getStrokeWidth();if(E.getMode()===I){for(var o=M=t.start_x,i=S=t.start_y,a={fill:e,stroke:r,"font-size":E.getFontSize(),stroke:r,"stroke-width":n,"font-family":E.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},s={elements:[{type:"path",attr:{id:"X-"+E.getNextId().replace("svg_",v),d:"m2.9674 294.65-1.9091-2.9389"}},{type:"path",attr:{id:E.getNextId().replace("svg_",v),d:"m2.9959 290.12v1.0583"}},{type:"circle",attr:{id:E.getNextId().replace("svg_",v),cx:"2.9891",cy:"291.41",r:".2581"}},{type:"path",attr:{id:E.getNextId().replace("svg_",v),d:"m2.9959 295.94v-1.0583"}},{type:"circle",attr:{id:E.getNextId().replace("svg_",v),cx:"2.9891",cy:"-294.66",r:".2581",transform:"scale(1,-1)"}}]},l={type:c,x:o,y:i,style:"pointer-events:none"},d=0;d<s.elements.length;d++)$.extend(s.elements[d].attr,a);return $.extend(l,a),u.x=o,u.y=i,g=E.getNextId().replace("svg_",v),(C=k.addSvgGroupFromJson({group:"g",id:g,type:c,attr:l,elements:s.elements})).setAttribute("transform","translate("+o+","+i+") scale(0.005) translate("+-o+","+-i+")"),k.recalculateDimensions(C),F=C.getBBox(),{started:!0}}},mouseMove:function(t){if(E.getMode()===I){var e=E.getZoom(),r=t.event,n=t.mouse_x/e,o=t.mouse_y/e,i=E.getTransformList(C),a=C.getBBox(),s=a.x,l=a.y,d=a.width,g=a.height,c=n-M,v=o-S,u=(Math.min(M,n),Math.min(S,o),Math.abs(n-M)),m=Math.abs(o-S),f=0,p=0,h=g?(g+v)/g:1,x=d?(d+c)/d:1;x=u/F.width||1,h=m/F.height||1,n<M&&(f=F.width),o<S&&(p=F.height);var y=A.createSVGTransform(),w=A.createSVGTransform(),b=A.createSVGTransform();if(y.setTranslate(-(s+f),-(l+p)),!r.shiftKey){var _=Math.min(Math.abs(x),Math.abs(h));x=_*(x<0?-1:1),h=_*(h<0?-1:1)}w.setScale(x,h),b.setTranslate(s+f,l+p),i.appendItem(b),i.appendItem(w),i.appendItem(y),k.recalculateDimensions(C),F=C.getBBox()}},mouseUp:function(t){if(E.getMode()===I)return{keep:t.event.clientX!=u.x&&t.event.clientY!=u.y,element:C,started:!1}},getClassId:function(){return c}}})},window.extValue=function(){svgEditor.addExtension("value",function(d){"use strict";var g,c,v=svgEditor.canvas,u="value",m="svg-ext-"+u,f="VAL_",p={};return{callback:function(){$("#value_panel").hide()},mouseDown:function(t){if(v.getMode()===u){var e=v.getColor("fill"),r=v.getColor("stroke");e!==r&&(e=r);for(var n=t.start_x,o=t.start_y,i={fill:e,stroke:r,"font-size":v.getFontSize(),stroke:r,"stroke-width":0,"font-family":v.getFontFamily(),"text-anchor":"middle","xml:space":"preserve",x:n,y:o},a={elements:[{type:"text",content:"##.##",attr:{id:v.getNextId().replace("svg_",f)}}]},s={type:m,x:n,y:o,style:"pointer-events:none"},l=0;l<a.elements.length;l++)$.extend(a.elements[l].attr,i);return $.extend(s,i),p.x=n,p.y=o,g=v.getNextId().replace("svg_",f),c=d.addSvgGroupFromJson({group:"g",id:g,type:m,attr:s,elements:a.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(v.getMode()===u)return{keep:t.event.clientX!=p.x&&t.event.clientY!=p.y,element:c,started:!1}},getClassId:function(){return m},setGaugeAttribute:function(t){console.log("value attr: "+t),0===t.elem.id.indexOf(f)&&t.elem.children&&t.elem.children.length&&t.elem.children[0].setAttribute(t.attr,t.value)}}})},window.extShapes=function(){window.svgEditor&&svgEditor.addExtension("shapes",function(){"use strict";var d,g,k,C,M,S=svgEditor.canvas,E=S.getRootElem(),A={},c={diamond:"m1,150l149,-149l149,149l-149,149l-149,-149z",triangle:"M 0.34322034,0.59540563 60.34322,40.595405 0.34322034,80.595402 Z",halfcircle:"m1.3621 7.8324c0 6.7512 4.824 12.226 10.773 12.226 5.9487 0 10.773-5.4748 10.773-12.226z",delay:"m1.3621 7.0188h16.353q5.4511 0 5.4511 5.6395 0 5.6395-5.4511 5.6395h-16.353z",looplimit:"m1.1234 6.4492h21.925v8.3845l-5.4812 5.24h-10.962l-5.4812-5.24z",prepara:"m6.5066 5.414h10.992l5.496 6.4146-5.496 6.4146h-10.992l-5.496-6.4146z",trape:"m1.4358 17.248 4.2257-11.309h12.677l4.2257 11.309z",offpage:"m1.1032 6.3486v3.3754l10.999 10.126 10.999-10.126v-3.3754z",ticket:"m1.0632 18.162v-12.427h14.789l6.7205 6.2133-6.7205 6.2133z",arrow:"m0.92906 12.502v-3.0016h16.594v-3.1517l5.2549 4.6525-5.2549 4.6525v-3.1517z",doublearrow:"m5.8876 12.193v2.8614l-4.5862-4.224 4.5862-4.224v2.8614h12.31v-2.8614l4.5862 4.224-4.5862 4.224v-2.8614z",rectindi:"m11.677 22.941-.044742-11.249m-5.1325-10.227h10.227v10.227h-10.227z",circleindi:"m17.305 6.8836a5.7579 5.7579 0 0 1 -5.7579 5.7579 5.7579 5.7579 0 0 1 -5.7579 -5.7579 5.7579 5.7579 0 0 1 5.7579 -5.7579 5.7579 5.7579 0 0 1 5.7579 5.7579zm-5.628 16.197-.04486-10.331"},F="shape",v={};return{callback:function(){$("#shape_panel").hide()},mouseDown:function(t){var e=S.getMode();if(e.substr(0,F.length)===F){var r=S.getColor("fill"),n=S.getColor("stroke"),o=S.getStrokeWidth(),i=S.getStyle(),a=C=t.start_x,s=M=t.start_y;g=e.substr((F+"-").length);var l={d:d=c[g],id:S.getNextId().replace("svg_","SHP_"),fill:r,"font-size":S.getFontSize(),stroke:n,"stroke-width":o,"font-family":S.getFontFamily(),"xml:space":"preserve",opacity:i.opacity/2,style:"pointer-events:none"};v.x=t.event.clientX,v.y=t.event.clientY,k=S.addSvgElementFromJson({element:"path",curStyles:!0,attr:l}),/[a-z]/.test(d)&&(d=c[g]=S.pathActions.convertPath(k),k.setAttribute("d",d),S.pathActions.fixEnd(k)),k.setAttribute("transform","translate("+a+","+s+") scale(0.005) translate("+-a+","+-s+")"),k.removeAttribute("opacity"),S.recalculateDimensions(k);S.getTransformList(k);return A=k.getBBox(),{started:!0}}},mouseMove:function(t){if(S.getMode().substr(0,F.length)===F){var e=S.getZoom(),r=t.event,n=t.mouse_x/e,o=t.mouse_y/e;svgEditor.curConfig.gridSnapping&&(n=svgedit.utilities.snapToGrid(n),o=svgedit.utilities.snapToGrid(o));var i=S.getTransformList(k),a=k.getBBox(),s=a.x,l=a.y,d=a.width,g=a.height,c=n-C,v=o-M,u=(Math.min(C,n),Math.min(M,o),Math.abs(n-C)),m=Math.abs(o-M),f=0,p=0,h=g?(g+v)/g:1,x=d?(d+c)/d:1;x=u/A.width||1,h=m/A.height||1,n<C&&(f=A.width),o<M&&(p=A.height);var y=E.createSVGTransform(),w=E.createSVGTransform(),b=E.createSVGTransform();if(y.setTranslate(-(s+f),-(l+p)),!r.shiftKey){var _=Math.min(Math.abs(x),Math.abs(h));x=_*(x<0?-1:1),h=_*(h<0?-1:1)}w.setScale(x,h),b.setTranslate(s+f,l+p),i.appendItem(b),i.appendItem(w),i.appendItem(y),S.recalculateDimensions(k),A=k.getBBox()}},mouseUp:function(t){if(S.getMode().substr(0,F.length)===F)return{keep:t.event.clientX!=v.x&&t.event.clientY!=v.y,element:k,started:!1}}}})},window.extValves=function(){svgEditor.addExtension("valves",function(m){"use strict";var f,p,h=svgEditor.canvas,x="valve",y="svg-ext-"+x,w={},b={ax:[{id:"l",d:"m0 0 15 9-15 9z"},{id:"r",d:"m16 0 15 9-15 9z",transform:"rotate(180,23.5,9)"}],bx:[{id:"l",d:"m8 8 15 9-15 9z",transform:"rotate(-90,15.5,17)"},{id:"r",d:"m16 0 15 9-15 9z",transform:"rotate(180,23.5,9)"}],cx:[{id:"l",d:"m0 0 15 9-15 9z"},{id:"l",d:"m8 8 15 9-15 9z",transform:"rotate(-90,15.5,17)"},{id:"r",d:"m16 0 15 9-15 9z",transform:"rotate(180,23.5,9)"}]};return{callback:function(){$("#valve_panel").hide()},mouseDown:function(t){var e=h.getMode();if(e.substr(0,x.length)===x){var r=h.getColor("fill"),n=h.getColor("stroke"),o=h.getStrokeWidth();h.getStyle();r===n&&(r="#FFFFFF",n="#000000");var i=e.substr((x+"-").length);b[i];for(var a=t.start_x,s=t.start_y-25,l={"font-size":h.getFontSize(),"font-family":h.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},d={elements:[]},g=0;g<b[i].length;g++){var c=b[i][g],v={id:"t"+c.id+h.getNextId().replace("svg_","VLA_"),d:c.d,"stroke-width":o};c.transform&&(v.transform=c.transform),d.elements.push({type:"path",attr:v})}var u={type:y,x:a,y:s,style:"pointer-events:none",fill:r,stroke:n};for(g=0;g<d.elements.length;g++)$.extend(d.elements[g].attr,l);return $.extend(u,l),w.x=a,w.y=s,f=h.getNextId().replace("svg_","VLA_"),(p=m.addSvgGroupFromJson({group:"g",id:f,type:y,attr:u,elements:d.elements})).setAttribute("transform","translate("+a+","+s+")"),h.recalculateDimensions(p),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(h.getMode().substr(0,x.length)===x)return{keep:t.event.clientX!=w.x&&t.event.clientY!=w.y,element:p,started:!1}},getClassId:function(){return y}}})},window.extMotors=function(){svgEditor.addExtension("motors",function(m){"use strict";var f,p,h=svgEditor.canvas,x="motor",y="svg-ext-"+x,w={},b={simb:[{id:"c",type:"ellipse",attr:{cx:"20",cy:"20",rx:"20.5",ry:"20.5"}},{id:"s",type:"path",attr:{d:"M 20,1 40,20.25 20,39.5 Z",fill:"#000000"}}]};return{callback:function(){$("#motor_panel").hide()},mouseDown:function(t){var e=h.getMode();if(e.substr(0,x.length)===x){var r=h.getColor("fill"),n=h.getColor("stroke"),o=h.getStrokeWidth();h.getStyle();r===n&&(r="#FFFFFF",n="#000000");var i=e.substr((x+"-").length);b[i];for(var a=t.start_x,s=t.start_y-35,l={fill:r,stroke:n,"font-size":h.getFontSize(),"font-family":h.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},d={elements:[]},g=0;g<b[i].length;g++){var c=b[i][g],v={id:c.id+h.getNextId().replace("svg_","MTR_"),"stroke-width":o};$.extend(v,c.attr),d.elements.push({type:c.type,attr:v})}var u={type:y,x:a,y:s,style:"pointer-events:none"};return $.extend(u,l),w.x=a,w.y=s,f=h.getNextId().replace("svg_","MTR_"),(p=m.addSvgGroupFromJson({group:"g",id:f,type:y,attr:u,elements:d.elements})).setAttribute("transform","translate("+a+","+s+")"),h.recalculateDimensions(p),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(h.getMode().substr(0,x.length)===x)return{keep:t.event.clientX!=w.x&&t.event.clientY!=w.y,element:p,started:!1}},getClassId:function(){return y}}})},window.extHtmlInput=function(){window.svgEditor&&svgEditor.addExtension("html_input",function(l){"use strict";var d;console.log("add HTML-input");var g,c=svgEditor.canvas,v=80,u=24,m="html_input",f="svg-ext-"+m,e={};return{callback:function(){$("#html_input_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,o=t.start_y,i=c.getNextId(),a=c.getNextId().replace("svg_","HXI_"),s={elements:[{type:"rect",attr:{x:n,y:o-u,width:v,height:u,"stroke-width":0,id:i}},{type:"foreignObject",content:[{tag:"input",attr:{id:"I-"+a,type:"text",value:""},style:"width:calc(100% - 7px);height:calc(100% - 7px);text-align: right;border: unset;"}],attr:{x:n,y:o-u,height:u,width:v,id:"H-"+a}}]};return d=l.getNextId().replace("svg_","HXI_"),g=l.addSvgGroupFromJson({group:"g",id:d,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlButton=function(){window.svgEditor&&svgEditor.addExtension("html_button",function(l){"use strict";var d;console.log("add HTML-button");var g,c=svgEditor.canvas,v=80,u=24,m="html_button",f="svg-ext-"+m,e={};return{callback:function(){$("#html_button_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,o=t.start_y,i=c.getNextId(),a=c.getNextId().replace("svg_","HXB_"),s={elements:[{type:"rect",attr:{x:n,y:o-u,width:v,height:u,fill:e,stroke:r,"stroke-width":0,id:i}},{type:"foreignObject",content:[{tag:"button",attr:{id:"B-"+a,class:"md-btn  md-btn-raised"},style:"width:100%;height:100%;"}],attr:{x:n,y:o-u,height:u,width:v,id:"H-"+a}}]};return d=c.getNextId().replace("svg_","HXB_"),g=l.addSvgGroupFromJson({group:"g",id:d,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlSelect=function(){window.svgEditor&&svgEditor.addExtension("html_select",function(l){"use strict";var d;console.log("add HTML-select");var g,c=svgEditor.canvas,v=80,u=26,m="html_select",f="svg-ext-"+m,e={};return{callback:function(){$("#html_select_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,o=t.start_y,i=c.getNextId(),a=c.getNextId().replace("svg_","HXS_"),s={elements:[{type:"rect",attr:{x:n,y:o-u,width:v,height:u,fill:e,stroke:r,"stroke-width":0,id:i}},{type:"foreignObject",content:[{tag:"select",attr:{id:"S-"+a},style:"width:100%;height:100%;text-align: right;margin-top:unset;"}],attr:{x:n,y:o-u,height:u,width:v,id:"H-"+a}}]};return d=l.getNextId().replace("svg_","HXS_"),g=l.addSvgGroupFromJson({group:"g",id:d,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlChart=function(){window.svgEditor&&svgEditor.addExtension("html_chart",function(l){"use strict";var d;console.log("add HTML-chart");var g,c=svgEditor.canvas,v=380,u=240,m="html_chart",f="svg-ext-"+m,e={};return{callback:function(){$("#html_chart_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,o=t.start_y,i=c.getNextId(),a=c.getNextId().replace("svg_","HXC_"),s={elements:[{type:"rect",attr:{x:n,y:o-u,width:v,height:u,"stroke-width":0,id:i}},{type:"foreignObject",content:[{tag:"div",attr:{id:"D-"+a},style:"width:100%;height:100%;"}],attr:{x:n,y:o-u,height:u,width:v,id:"H-"+a}}]};return d=l.getNextId().replace("svg_","HXC_"),g=l.addSvgGroupFromJson({group:"g",id:d,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extGaugeProgress=function(){window.svgEditor&&svgEditor.addExtension("gauge_progress",function(u){"use strict";var m;console.log("add Gauge-progress 0.1");var f,p=svgEditor.canvas,h=100,x=25,y="gauge_progress",w="svg-ext-"+y,b="GXP_",_={};return{callback:function(){$("#gauge_progress_panel").hide()},mouseDown:function(t){if(p.getMode()===y){var e,r=p.getColor("fill"),n=p.getColor("stroke"),o=p.getStrokeWidth(),i=p.getFontSize(),a=t.start_x,s=t.start_y-h,l={"font-size":i,stroke:n,"stroke-width":o,"font-family":p.getFontFamily(),"xml:space":"preserve"},d=p.getNextId().replace("svg_",b);e=[];for(var g={elements:[{type:"rect",attr:{id:"A-"+p.getNextId().replace("svg_",b),x:a,y:s,width:x,height:h,fill:r}},{type:"rect",attr:{id:"B-"+p.getNextId().replace("svg_",b),x:a,y:s+h/2,width:x,height:h/2,fill:"#1565c0"}},{type:"foreignObject",content:e,attr:{x:a,y:s,height:h,width:x,id:"H-"+d}}]},c={type:w,x:a,y:s,style:"pointer-events:none"},v=0;v<g.elements.length;v++)$.extend(g.elements[v].attr,l);return $.extend(c,l),_.x=a,_.y=s,m=p.getNextId().replace("svg_",b),f=u.addSvgGroupFromJson({group:"g",id:m,type:w,attr:c,elements:g.elements}),{started:!0}}},mouseMove:function(t){p.getMode()},mouseUp:function(t){if(p.getMode()===y)return console.log("progress up2"),{keep:t.event.clientX!=_.x&&t.event.clientY!=_.y,element:f,started:!1}},getClassId:function(){return w}}})},window.extGaugeSemaphore=function(){svgEditor.addExtension("gauge_semaphore",function(g){"use strict";var c,v,u=svgEditor.canvas,m="gauge_semaphore",f="svg-ext-"+m,p={};return{callback:function(){$("#gauge_semaphore_panel").hide()},mouseDown:function(t){if(u.getMode()===m){for(var e=u.getColor("fill"),r=u.getColor("stroke"),n=u.getStrokeWidth(),o=t.start_x,i=t.start_y-30,a={fill:e,"font-size":u.getFontSize(),stroke:r,"stroke-width":n,"font-family":u.getFontFamily(),"xml:space":"preserve"},s={elements:[{type:"ellipse",attr:{id:u.getNextId().replace("svg_","GSE_"),cx:"15",cy:"15",rx:"14",ry:"14","stroke-width":"none"}}]},l={type:f,x:o,y:i,style:"pointer-events:none"},d=0;d<s.elements.length;d++)$.extend(s.elements[d].attr,a);return $.extend(l,a),p.x=o,p.y=i,c=u.getNextId().replace("svg_","GSE_"),(v=g.addSvgGroupFromJson({group:"g",id:c,type:f,attr:l,elements:s.elements})).setAttribute("transform","translate("+o+","+i+")"),g.recalculateDimensions(v),v.getBBox(),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(u.getMode()===m)return{keep:t.event.clientX!=p.x&&t.event.clientY!=p.y,element:v,started:!1}},getClassId:function(){return f}}})},window.extExchangers=function(){svgEditor.addExtension("exchangers",function(m){"use strict";var f,p,h=svgEditor.canvas,x="exchanger",y="svg-ext-"+x,w={},b={filter:[{id:"f",type:"path",attr:{d:"M 0,0 70,70 M 14,0 70,56 M 28,0 70,42 M 42,0 70,28 M 56,0 70,14 M 0,14 56,70 M 0,28 42,70 M 0,42 28,70 M 0,56 14,70 M 0,14 14,0 M 0,28 28,0 M 0,42 42,0 M 0,56 56,0 M 0,70 70,0 M 70,14 14,70 M 28,70 70,28 M 70,42 42,70 M 56,70 70,56 M 0,0 H 70 V 70 H 0 Z"}}],heat:[{id:"h",type:"path",attr:{d:"M 70,0 0,40 M 0,0 H 70 V 40 H 0 Z"}}],tube:[{id:"t",type:"path",attr:{d:"M 7.04,0 V 40 M 80.96,0 V 40 M 7.04,5 H 80.96 M 7.04,10 H 80.96 M 7.04,15 H 80.96 M 7.04,20 H 80.96 M 7.04,25 H 80.96 M 7.04,30 H 80.96 M 7.04,35 H 80.96 M 0,0 H 88 V 40 H 0 Z"}}]};return{callback:function(){$("#exchanger_panel").hide()},mouseDown:function(t){var e=h.getMode();if(e.substr(0,x.length)===x){var r=h.getColor("fill"),n=h.getColor("stroke"),o=h.getStrokeWidth();h.getStyle();r===n&&(r="#FFF");for(var i=e.substr((x+"-").length),a=t.start_x,s=t.start_y-35,l={fill:r,"font-size":h.getFontSize(),stroke:n,"font-family":h.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},d={elements:[]},g=0;g<b[i].length;g++){var c=b[i][g],v={id:c.id+h.getNextId().replace("svg_","EHS_"),"stroke-width":o};$.extend(v,c.attr),d.elements.push({type:c.type,attr:v})}var u={type:y,x:a,y:s,style:"pointer-events:none"};return $.extend(u,l),w.x=a,w.y=s,f=h.getNextId().replace("svg_","EHS_"),(p=m.addSvgGroupFromJson({group:"g",id:f,type:y,attr:u,elements:d.elements})).setAttribute("transform","translate("+a+","+s+")"),h.recalculateDimensions(p),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(h.getMode().substr(0,x.length)===x)return{keep:t.event.clientX!=w.x&&t.event.clientY!=w.y,element:p,started:!1}},getClassId:function(){return y}}})};