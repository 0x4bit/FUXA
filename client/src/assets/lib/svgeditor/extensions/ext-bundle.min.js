window.extConnector=function(){window.svgEditor&&svgEditor.addExtension("Connector",function(t){var v,u,m,f,h,p,w=t.svgcontent,c=t.svgroot,l=t.getNextId,x=t.getElem,y=t.addSvgElementFromJson,b=t.selectorManager,g=svgEditor.curConfig,_=!1,k=[],C=".se_connector",E=[],S=$.data,e={en:[{id:"mode_connect",title:"Connect two objects"}],fr:[{id:"mode_connect",title:"Connecter deux objets"}]};function A(t,e,r,n){n&&(n-=0,(r=$.extend({},r)).width+=n,r.height+=n,r.x-=n/2,r.y-=n/2);var i,o=r.x+r.width/2,a=r.y+r.height/2,s=t-o,d=e-a;return{x:o+s*(i=Math.abs(d/s)<r.height/r.width?r.width/2/Math.abs(s):r.height/2/Math.abs(d)),y:a+d*i}}function M(t,e){var r=!!e.getAttribute("marker-"+t),n=5*e.getAttribute("stroke-width");return r?n:0}function n(t){var e=$("#connector_rules");e.length||(e=$('<style id="connector_rules"></style>').appendTo("head")),e.text(t?"#tool_clone, #tool_topath, #tool_angle, #xy_panel { display: none !important; }":""),$("#connector_panel").toggle(t)}function I(e,r,n,i,t){var o,a=e.points,s=c.createSVGPoint();s.x=n,s.y=i,"end"===r&&(r=a.numberOfItems-1);try{a.replaceItem(s,r)}catch(t){var d=e.getAttribute("points").split(" ");for(o=0;o<d.length;o++)o===r&&(d[o]=n+","+i);e.setAttribute("points",d.join(" "))}if(t){var l=a.getItem(0),g=a.getItem(a.numberOfItems-1);I(e,1,(g.x+l.x)/2,(g.y+l.y)/2)}}function N(s){var d;s||(s=E);var t=$(w).find(C);k=[],t.each(function(){var t;function e(){-1!==$.inArray(this,s)&&(t=!0)}var r=S(this,"c_start"),n=S(this,"c_end"),i=[x(r),x(n)];for(d=0;d<2;d++){var o=i[d];if(t=!1,$(o).parents().each(e),o&&o.parentNode){if(-1!==$.inArray(o,s)||t){var a=svgCanvas.getStrokedBBox([o]);k.push({elem:o,connector:this,is_start:0===d,start_x:a.x,start_y:a.y})}}else $(this).remove()}})}function F(t){var e,r;if(N(t),k.length)for(e=k.length;e--;){var n=k[e],i=n.connector,o=n.elem,a=(i.getAttribute("stroke-width"),n.is_start?"start":"end"),s=svgCanvas.getStrokedBBox([o]);s.x=n.start_x,s.y=n.start_y,S(i,a+"_bb",s);S(i,a+"_off");var d=n.is_start?"end":"start",l=S(i,d+"_bb"),g=A(l.x+l.width/2,l.y+l.height/2,s,M(a,i));I(i,n.is_start?0:"end",g.x,g.y,!0);var c=A(g.x,g.y,S(i,d+"_bb"),M(d,i));if(I(i,n.is_start?"end":0,c.x,c.y,!0),-1!==navigator.userAgent.indexOf("AppleWebKit")){var v=i.points,u=v.numberOfItems,m=[];for(r=0;r<u;r++)g=v.getItem(r),m[r]=g.x+","+g.y;i.setAttribute("points",m.join(" "))}}}return function(){var t=svgCanvas.groupSelectedElements;svgCanvas.groupSelectedElements=function(){return svgCanvas.removeFromSelection($(C).toArray()),t.apply(this,arguments)};var e=svgCanvas.moveSelectedElements;svgCanvas.moveSelectedElements=function(){svgCanvas.removeFromSelection($(C).toArray());var t=e.apply(this,arguments);return F(),t},p=svgCanvas.getEditorNS()}(),{name:"Connector",buttons:[{id:"mode_connect",type:"mode",title:"Connect two objects",includeWith:{button:"#tool_line",isDefault:!1,position:1},events:{click:function(){svgCanvas.setMode("connector")}}}],addLangData:function(t){return{data:e[t]}},mouseDown:function(t){var e=t.event;v=t.start_x,u=t.start_y;var r=svgCanvas.getMode();if("connector"==r){if(_)return;var n=e.target,i=$(n).parents();if(-1!==$.inArray(w,i)){var o=$(n).closest("foreignObject");f=o.length?o[0]:n;var a=svgCanvas.getStrokedBBox([f]),s=a.x+a.width/2,d=a.y+a.height/2;_=!0,m=y({element:"polyline",attr:{id:l(),points:s+","+d+" "+s+","+d+" "+v+","+u,stroke:"#"+g.initStroke.color,"stroke-width":f.stroke_width&&0!=f.stroke_width?f.stroke_width:g.initStroke.width,fill:"none",opacity:g.initStroke.opacity,style:"pointer-events:none"}}),S(m,"start_bb",a)}return{started:!0}}"select"==r&&N()},mouseMove:function(t){var e=svgCanvas.getZoom(),r=(t.event,t.mouse_x/e),n=t.mouse_y/e,i=r-v,o=n-u,a=svgCanvas.getMode();if("connector"==a&&_){m.getAttribute("stroke-width");var s=A(r,n,S(m,"start_bb"),M("start",m));v=s.x,u=s.y,I(m,0,s.x,s.y,!0),I(m,"end",r,n,!0)}else if("select"==a){for(var d=E.length;d--;){var l=E[d];l&&S(l,"c_start")&&(svgCanvas.removeFromSelection([l]),svgCanvas.getTransformList(l).clear())}k.length&&function(t,e){for(var r=k.length;r--;){var n=k[r],i=n.connector,o=(n.elem,n.is_start?"start":"end"),a=S(i,o+"_bb");a.x=n.start_x+t,a.y=n.start_y+e,S(i,o+"_bb",a);var s=n.is_start?"end":"start",d=S(i,s+"_bb"),l=A(d.x+d.width/2,d.y+d.height/2,a,M(o,i));I(i,n.is_start?0:"end",l.x,l.y,!0);var g=A(l.x,l.y,S(i,s+"_bb"),M(s,i));I(i,n.is_start?"end":0,g.x,g.y,!0)}}(i,o)}},mouseUp:function(t){var e=svgCanvas.getZoom(),r=t.event,n=(t.mouse_x,t.mouse_y,r.target);if("connector"==svgCanvas.getMode()){var i=$(n).closest("foreignObject");i.length&&(n=i[0]);var o=$(n).parents();if(n==f)return{keep:_=!0,element:null,started:_};if(-1===$.inArray(w,o))return $(m).remove(),{keep:_=!1,element:null,started:_};h=n;var a=f.id,s=h.id,d=a+" "+s,l=s+" "+a;if($(w).find(C).filter(function(){var t=this.getAttributeNS(p,"connector");if(t==d||t==l)return!0}).length)return $(m).remove(),{keep:!1,element:null,started:!1};var g=svgCanvas.getStrokedBBox([h]),c=A(v,u,g,M("start",m));return I(m,"end",c.x,c.y,!0),$(m).data("c_start",a).data("c_end",s).data("end_bb",g),p=svgCanvas.getEditorNS(!0),m.setAttributeNS(p,"se:connector",d),m.setAttribute("class",C.substr(1)),m.setAttribute("opacity",1),svgCanvas.addToSelection([m]),svgCanvas.moveToBottomSelectedElement(),b.requestSelector(m).showGrips(!1),{keep:!(_=!1),element:m,started:_}}},selectedChanged:function(t){if($(w).find(C).length){"connector"==svgCanvas.getMode()&&svgCanvas.setMode("select");for(var e=(E=t.elems).length;e--;){var r=E[e];r&&S(r,"c_start")?(b.requestSelector(r).showGrips(!1),t.selectedElement&&!t.multiselected?n(!0):n(!1)):n(!1)}F()}},elementChanged:function(t){var e,r=t.elems[0];if(r&&"svg"===r.tagName&&"svgcontent"===r.id&&(w=r,$(w).find("*").each(function(){var t=this.getAttributeNS(p,"connector");if(t){this.setAttribute("class",C.substr(1));var e=t.split(" "),r=svgCanvas.getStrokedBBox([x(e[0])]),n=svgCanvas.getStrokedBBox([x(e[1])]);$(this).data("c_start",e[0]).data("c_end",e[1]).data("start_bb",r).data("end_bb",n),svgCanvas.getEditorNS(!0)}})),r&&(r.getAttribute("marker-start")||r.getAttribute("marker-mid")||r.getAttribute("marker-end"))){e=r.getAttribute("marker-start");var n=r.getAttribute("marker-mid"),i=r.getAttribute("marker-end");if(m=r,$(r).data("start_off",!!e).data("end_off",!!i),"line"===r.tagName&&n){var o=Number(r.getAttribute("x1")),a=Number(r.getAttribute("x2")),s=Number(r.getAttribute("y1")),d=Number(r.getAttribute("y2")),l=r.id,g=y({element:"polyline",attr:{points:o+","+s+(" "+(o+a)/2+","+(s+d)/2+" ")+a+","+d,stroke:r.getAttribute("stroke"),"stroke-width":r.getAttribute("stroke-width"),"marker-mid":n,fill:"none",opacity:r.getAttribute("opacity")||1}});$(r).after(g).remove(),svgCanvas.clearSelection(),g.id=l,svgCanvas.addToSelection([g]),r=g}}r.getAttribute("class")==C.substr(1)?F([e=x(S(r,"c_start"))]):F()},toolButtonStateUpdate:function(t){t.nostroke&&$("#mode_connect").hasClass("tool_button_current")&&svgEditor.clickSelect(),$("#mode_connect").toggleClass("disabled",t.nostroke)}}})},window.extEyedropper=function(){window.svgEditor&&svgEditor.addExtension("eyedropper",function(t){"use strict";var o=svgEditor.canvas,a=svgedit.history.ChangeElementCommand,s={fillPaint:"red",fillOpacity:1,strokePaint:"black",strokeOpacity:1,strokeWidth:5,strokeDashArray:null,opacity:1,strokeLinecap:"butt",strokeLinejoin:"miter"};function e(t){if("eyedropper"!=o.getMode()){var e=null,r=$("#tool_eyedropper");!t.multiselected&&t.elems[0]&&-1===$.inArray(t.elems[0].nodeName,["svg","g","use"])?(e=t.elems[0],r.removeClass("disabled"),s.fillPaint=e.getAttribute("fill")||"black",s.fillOpacity=e.getAttribute("fill-opacity")||1,s.strokePaint=e.getAttribute("stroke"),s.strokeOpacity=e.getAttribute("stroke-opacity")||1,s.strokeWidth=e.getAttribute("stroke-width"),s.strokeDashArray=e.getAttribute("stroke-dasharray"),s.strokeLinecap=e.getAttribute("stroke-linecap"),s.strokeLinejoin=e.getAttribute("stroke-linejoin"),s.opacity=e.getAttribute("opacity")||1):r.addClass("disabled")}}return{name:"eyedropper",buttons:[{id:"tool_eyedropper",type:"mode",title:"Eye Dropper Tool",key:"I",events:{click:function(){o.setMode("eyedropper")}}}],selectedChanged:e,elementChanged:e,mouseDown:function(t){var e;if("eyedropper"==o.getMode()){var r=t.event.target;if(-1===$.inArray(r.nodeName,["svg","g","use"])){var n={},i=function(t,e,r){n[e]=t.getAttribute(e),t.setAttribute(e,r)};s.fillPaint&&i(r,"fill",s.fillPaint),s.fillOpacity&&i(r,"fill-opacity",s.fillOpacity),s.strokePaint&&i(r,"stroke",s.strokePaint),s.strokeOpacity&&i(r,"stroke-opacity",s.strokeOpacity),s.strokeWidth&&i(r,"stroke-width",s.strokeWidth),s.strokeDashArray&&i(r,"stroke-dasharray",s.strokeDashArray),s.opacity&&i(r,"opacity",s.opacity),s.strokeLinecap&&i(r,"stroke-linecap",s.strokeLinecap),s.strokeLinejoin&&i(r,"stroke-linejoin",s.strokeLinejoin),e=new a(r,n),o.undoMgr.addCommandToHistory(e)}}}}})},window.extGrid=function(){window.svgEditor&&svgEditor.addExtension("view_grid",function(){"use strict";var t=svgedit.NS,c=svgEditor.canvas,e=document.getElementById("svgcanvas").ownerDocument,r=svgEditor.curConfig.showGrid||!1,n=c.assignAttributes,v=document.createElement("canvas"),i=$("#canvasBackground"),u=svgedit.units.getTypeMap(),m=[.01,.1,1,10,100,1e3];$(v).hide().appendTo("body");var o=e.createElementNS(t.SVG,"svg");n(o,{id:"canvasGrid",width:"100%",height:"100%",x:0,y:0,overflow:"visible",display:"none"}),i.append(o);var a=e.createElementNS(t.SVG,"pattern");n(a,{id:"gridpattern",patternUnits:"userSpaceOnUse",x:0,y:0,width:100,height:100});var f=e.createElementNS(t.SVG,"image");n(f,{x:0,y:0,width:100,height:100}),a.appendChild(f),$("#svgroot defs").append(a);var s=e.createElementNS(t.SVG,"rect");function d(t){var e,r=u[svgEditor.curConfig.baseUnit]*t,n=100/r,i=1;for(e=0;e<m.length;e++){var o=m[e];if(n<=(i=o))break}var a=i*r;v.width=a,v.height=a;var s=v.getContext("2d"),d=a/10;for(s.globalAlpha=.2,s.strokeStyle=svgEditor.curConfig.gridColor,e=1;e<10;e++){var l=Math.round(d*e)+.5;s.moveTo(l,a),s.lineTo(l,0),s.moveTo(a,l),s.lineTo(0,l)}s.stroke(),s.beginPath(),s.globalAlpha=.5,s.moveTo(.5,a),s.lineTo(.5,0),s.moveTo(a,.5),s.lineTo(0,.5),s.stroke();var g=v.toDataURL("image/png");f.setAttribute("width",a),f.setAttribute("height",a),f.parentNode.setAttribute("width",a),f.parentNode.setAttribute("height",a),c.setHref(f,g)}function l(){r&&d(c.getZoom()),$("#canvasGrid").toggle(r)}return n(s,{width:"100%",height:"100%",x:0,y:0,"stroke-width":0,stroke:"none",fill:"url(#gridpattern)",style:"pointer-events: none; display:visible;"}),$("#canvasGrid").append(s),{name:"view_grid",zoomChanged:function(t){r&&d(t)},callback:function(){r&&l()},buttons:[{id:"view_grid",events:{click:function(){svgEditor.curConfig.showGrid=r=!r,l()}}}]}})},window.extMarkers=function(){window.svgEditor&&svgEditor.addExtension("Markers",function(h){var p,w=h.addSvgElementFromJson,l=["start","mid","end"],g="se_marker_",x={nomarker:{label:"&#x2014;"},leftarrow:{element:"path",attr:{d:"M0,50 L100,90 L70,50 L100,10 Z"},label:"&#x25C4;"},rightarrow:{element:"path",attr:{d:"M100,50 L0,90 L30,50 L0,10 Z"},label:"&#x25BA;"},leftpointing:{element:"path",attr:{d:"M50,48 L90,90 M50,52 L90,10"},label:"&#x2009;&#x02C2;"},rightpointing:{element:"path",attr:{d:"M50,48 L10,90 L50,52 L10,10 Z"},label:"&#x2009;&#x003E;"},break:{element:"path",attr:{d:"M50,20 L50,80"},label:"&#x2009;&#x2223;"},mcircle:{element:"circle",attr:{r:30,cx:50,cy:50},label:"&#x2009;&#x25CF;"}};function c(t,e){var r=t.getAttribute(e);if(!r)return null;var n=r.match(/\(\#(.*)\)/);return n&&2===n.length?h.getElem(n[1]):null}function s(t,r){"\\"!==r.substr(0,1)&&(r="\\textmarker");var e=document.getElementById(t+"_marker"),n=0;$.each(x,function(t,e){if(-1!==r.indexOf(t))return!1;n++}),e.selectedIndex=n}function i(t){if($("#marker_panel").toggle(t),t){var i,o,a=p[0];$.each(l,function(t,e){var r=c(a,"marker-"+e),n=$("#"+e+"_marker");if(r){if(!r.attributes.se_type)return;i="\\"+r.attributes.se_type.textContent,"\\textmarker"===(o=i)?i=r.lastChild.textContent:n.hide()}else o=i="\\nomarker",n.hide();n.val(i),s(e,o)})}}function v(t,e){var r=h.getElem(t);if(!r&&""!=e&&"\\nomarker"!=e){var n,i=p[0].getAttribute("stroke"),o=50,a=50,s="0 0 100 100",d=10,l=10;if(n="\\"===e.substr(0,1)?e.substr(1):"textmarker",x[n]){if(r=w({element:"marker",attr:{id:t,orient:"auto",style:"pointer-events:none",se_type:n}}),"textmarker"!=n){var g=w(x[n]),c=i;"_o"===n.substr(-2)&&(c="none"),g.setAttribute("fill",c),g.setAttribute("stroke",i),g.setAttribute("stroke-width",10),r.appendChild(g)}else{var v=w(x[n]);v.textContent=e;var u=v.getBBox(),m=u;m.x=0,m.y=0,m.width+=2,m.height+=2,v.setAttribute("x",1),v.setAttribute("y",m.height-1-u.height/4),v.setAttribute("fill",i),o=m.width/2+1,a=m.height/2+1,s=m.x+" "+m.y+" "+m.width+" "+m.height,d=m.width/10,l=m.height/10;var f=w({element:"rect",attr:{x:m.x,y:m.y,width:m.width,height:m.height,fill:"#ffffff",stroke:"none","stroke-width":0}});r.setAttribute("orient",0),r.appendChild(f),r.appendChild(v)}return r.setAttribute("viewBox",s),r.setAttribute("markerWidth",d),r.setAttribute("markerHeight",l),r.setAttribute("refX",o),r.setAttribute("refY",a),h.findDefs().appendChild(r),r}}}function u(n){if("line"!==n.tagName)return n;var t=Number(n.getAttribute("x1")),e=Number(n.getAttribute("x2")),r=Number(n.getAttribute("y1")),i=Number(n.getAttribute("y2")),o=n.id,a=w({element:"polyline",attr:{points:t+","+r+(" "+(t+e)/2+","+(r+i)/2+" ")+e+","+i,stroke:n.getAttribute("stroke"),"stroke-width":n.getAttribute("stroke-width"),fill:"none",opacity:n.getAttribute("opacity")||1}});$.each(l,function(t,e){var r="marker-"+e;n.getAttribute(r)&&a.setAttribute(r,n.getAttribute(r))});var s=new h.BatchCommand;return s.addSubCommand(new h.RemoveElementCommand(n,n.parentNode)),s.addSubCommand(new h.InsertElementCommand(a)),$(n).after(a).remove(),svgCanvas.clearSelection(),a.id=o,svgCanvas.addToSelection([a]),h.addCommandToHistory(s),a}return{name:"Markers",mySetMarker:function(t,r){var n=void 0,i=0;$.each(x,function(t,e){r===i++&&(n=t)}),function(t,e){var r={start_marker:"start",mid_marker:"mid",end_marker:"end"}[t],n="marker-"+r,i=e,o=p[0],a=c(o,n);if(a&&$(a).remove(),o.removeAttribute(n),""==i&&(i="\\nomarker"),"\\nomarker"==i)return s(r,i),h.call("changed",p);v(t=g+r+"_"+o.id,i),svgCanvas.changeSelectedAttribute(n,"url(#"+t+")"),"line"===o.tagName&&"mid"==r&&(o=u(o)),h.call("changed",p),s(r,i)}(t,"\\"+n)},callback:function(){var a=document.getElementById("start_marker"),s=document.getElementById("mid_marker"),d=document.getElementById("end_marker");$.each(x,function(t,e){if(e.label){var r=document.createElement("option");r.value=e.label,r.innerHTML=e.label,r.setAttribute("style","background-color: rgba(33,33,33,1);color: rgba(255,255,255,1);");var n=r.cloneNode(!0),i=r.cloneNode(!0),o=r.cloneNode(!0);a.appendChild(n),s.appendChild(i),d.appendChild(o)}})},selectedChanged:function(t){for(var e=(p=t.elems).length,r=["line","path","polyline"];e--;){var n=p[e];n&&-1!==$.inArray(n.tagName,r)&&t.selectedElement&&!t.multiselected?i(!0):i(!1)}},elementChanged:function(t){var d,a,s,e=t.elems[0];if(e&&(e.getAttribute("marker-start")||e.getAttribute("marker-mid")||e.getAttribute("marker-end"))){s=(a=e).getAttribute("stroke"),$.each(l,function(t,e){var r=c(a,"marker-"+e);if(r&&r.attributes.se_type){var n=r.lastElementChild;if(n){var i=n.getAttribute("fill"),o=n.getAttribute("stroke");i&&"none"!=i&&n.setAttribute("fill",s),o&&"none"!=o&&n.setAttribute("stroke",s)}}}),d=e,$.each(l,function(t,e){var r=g+e+"_"+d.id,n="marker-"+e,i=c(d,n);if(i&&i.attributes.se_type){var o=d.getAttribute(n);if(o){var a=d.id.length,s=o.substr(-a-1,a);d.id!=s&&(v(r,$("#"+e+"_marker").attr("value")),svgCanvas.changeSelectedAttribute(n,"url(#"+r+")"),"line"===d.tagName&&"mid"==e&&(d=u(d)),h.call("changed",p))}}});e&&-1!==$.inArray(e.tagName,["line","path","polyline"])&&i(!0)}}}})},window.extOverview=function(){if(window.svgEditor){var e={};svgEditor.addExtension("overview_window",function(){"use strict";$("#sidepanels").append('\t\t<div id="overview_window_content_pane" style=" width:100%; word-wrap:break-word;  display:inline-block; margin-top:20px;">\t\t\t<div id="overview_window_content" style="position:relative; left:12px; top:0px;">\t\t\t\t<div style="background-color:#A0A0A0; display:inline-block; overflow:visible;">\t\t\t\t\t<svg id="overviewMiniView" width="150" height="100" x="0" y="0" viewBox="0 0 4800 3600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\t\t\t\t\t\t<use x="0" y="0" xlink:href="#svgroot"> </use>\t\t\t\t\t </svg>\t\t\t\t\t <div id="overview_window_view_box" style="min-width:50px; min-height:50px; position:absolute; top:30px; left:30px; z-index:5; background-color:rgba(255,0,102,0.3);">\t\t\t\t\t </div>\t\t\t\t </div>\t\t\t</div>\t\t</div>');var o=function(){var t=parseFloat($("#workarea").css("height")),e=parseFloat($("#workarea").css("width")),r=$("#workarea").scrollLeft(),n=$("#workarea").scrollTop(),i=parseFloat($("#svgcanvas").css("width")),o=parseFloat($("#svgcanvas").css("height")),a=$("#overviewMiniView").attr("width"),s=$("#overviewMiniView").attr("height"),d=r/i*a,l=n/o*s,g=e/i*a,c=t/o*s;$("#overview_window_view_box").css("min-width",g+"px"),$("#overview_window_view_box").css("min-height",c+"px"),$("#overview_window_view_box").css("top",l+"px"),$("#overview_window_view_box").css("left",d+"px")};$("#workarea").scroll(function(){e.viewBoxDragging||o()}),$("#workarea").resize(o),o();var t=function(){var t=$("#svgroot").attr("width"),e=$("#svgroot").attr("height"),r=640,n=480;svgedit.browser.isIE()&&(n=r=0);var i=e/t*$("#overviewMiniView").attr("width");$("#overviewMiniView").attr("viewBox",r+" "+n+" "+t+" "+e),$("#overviewMiniView").attr("height",i),o()};t(),e.viewBoxDragging=!1;var l=function(){var t=parseFloat($("#svgcanvas").css("width")),e=parseFloat($("#svgcanvas").css("height")),r=$("#overviewMiniView").attr("width"),n=$("#overviewMiniView").attr("height"),i=parseFloat($("#overview_window_view_box").css("left"))/r*t,o=parseFloat($("#overview_window_view_box").css("top"))/n*e;$("#workarea").scrollLeft(i),$("#workarea").scrollTop(o)};return $("#overview_window_view_box").draggable({containment:"parent",drag:l,start:function(){e.viewBoxDragging=!0},stop:function(){e.viewBoxDragging=!1}}),$("#overviewMiniView").click(function(t){var e=t.offsetX||t.originalEvent.layerX,r=t.offsetY||t.originalEvent.layerY,n=$("#overviewMiniView").attr("width"),i=$("#overviewMiniView").attr("height"),o=parseFloat($("#overview_window_view_box").css("min-width")),a=parseFloat($("#overview_window_view_box").css("min-height")),s=e-.5*o,d=r-.5*a;s<0&&(s=0),d<0&&(d=0),n<s+o&&(s=n-o),i<d+a&&(d=i-a),$("#overview_window_view_box").css("top",d+"px"),$("#overview_window_view_box").css("left",s+"px"),l()}),{name:"overview window",canvasUpdated:t,workareaResized:o}})}},window.extPanning=function(){window.svgEditor&&svgEditor.addExtension("ext-panning",function(){"use strict";return{name:"Extension Panning",buttons:[{id:"ext-panning",type:"mode",title:"Panning",events:{click:function(){svgCanvas.setMode("ext-panning")}}}],mouseDown:function(){if("ext-panning"==svgCanvas.getMode())return svgEditor.setPanning(!0),{started:!0}},mouseUp:function(){if("ext-panning"==svgCanvas.getMode())return svgEditor.setPanning(!1),{keep:!1,element:null}}}})},window.extStorage=function(){window.svgEditor&&svgEditor.addExtension("storage",function(){var d=svgEditor.curConfig.emptyStorageOnDecline,l=svgEditor.curConfig.noStorageOnLoad,g=svgEditor.curConfig.forceStorage,c=svgEditor.storage;function v(n){n=n?"storagePrompt="+n:"";var t=top.location;-1<t.href.indexOf("storagePrompt=")?t.href=t.href.replace(/([&?])storagePrompt=[^&]*(&?)/,function(t,e,r){return(n?e:"")+n+(!n&&r?e:r||"")}):t.href+=(-1<t.href.indexOf("?")?"&":"?")+n}function u(t){if(c){var e="svgedit-"+svgEditor.curConfig.canvasName;t?c.setItem(e,t):c.removeItem(e)}}function m(t){document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"}function f(){window.addEventListener("beforeunload",function(t){if(document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){var e;document.cookie.match(/(?:^|;\s*)store=prefsAndContent/)&&u(svgCanvas.getSvgString()),svgEditor.setConfig({no_save_warning:!0});var r=svgEditor.curPrefs;for(e in r)if(r.hasOwnProperty(e)){var n=r[e];if(e="web-edit-"+e,!(null!=n))continue;c?c.setItem(e,n):window.widget?widget.setPreferenceForKey(n,e):(n=encodeURIComponent(n),document.cookie=encodeURIComponent(e)+"="+n+"; expires=Fri, 31 Dec 9999 23:59:59 GMT")}}},!1)}var h=!1;return{name:"storage",langReady:function(t){var e=t.uiStrings,r=$.deparam.querystring(!0).storagePrompt;if(!h)if(h=!0,g||!0!==r&&(!1===r||document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))l&&!g||f();else{var n=[];c?n.unshift({value:"prefsAndContent",text:e.confirmSetStorage.storagePrefsAndContent},{value:"prefsOnly",text:e.confirmSetStorage.storagePrefsOnly},{value:"noPrefsOrContent",text:e.confirmSetStorage.storageNoPrefsOrContent}):n.unshift({value:"prefsOnly",text:e.confirmSetStorage.storagePrefs},{value:"noPrefsOrContent",text:e.confirmSetStorage.storageNoPrefs});var i=$("#dialog_container")[0].style.width,o=$("#dialog_container")[0].style.marginLeft,a=$("#dialog_content")[0].style.height,s=$("#dialog_container")[0].style.height;$("#dialog_content")[0].style.height="120px",$("#dialog_container")[0].style.height="170px",$("#dialog_container")[0].style.width="800px",$("#dialog_container")[0].style.marginLeft="-400px",$.select(e.confirmSetStorage.message,n,function(t,e){if(t&&"noPrefsOrContent"!==t){if(document.cookie="store="+encodeURIComponent(t)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT",!0===r&&e)return void v()}else if(m("store"),t&&d&&function(){var t;for(t in u(""),svgEditor.curPrefs)svgEditor.curPrefs.hasOwnProperty(t)&&(t="web-edit-"+t,c&&c.removeItem(t),m(t))}(),t&&e)return void v("false");$("#dialog_container")[0].style.width=i,$("#dialog_container")[0].style.marginLeft=o,$("#dialog_content")[0].style.height=a,$("#dialog_container")[0].style.height=s,f(),svgEditor.storagePromptClosed=!0},null,null,{label:e.confirmSetStorage.rememberLabel,checked:!1,tooltip:e.confirmSetStorage.rememberTooltip})}}}})},window.extSwitch=function(){svgEditor.addExtension("switch",function(k){"use strict";var g,C,E,S,A=svgEditor.canvas,M=A.getRootElem(),I={},N="switch",c="svg-ext-"+N,v="SWI_",u={};return{callback:function(){$("#switch_panel").hide()},mouseDown:function(t){var e=A.getColor("fill"),r=A.getColor("stroke"),n=A.getStrokeWidth();if(A.getMode()===N){for(var i=E=t.start_x,o=S=t.start_y,a={fill:e,stroke:r,"font-size":A.getFontSize(),stroke:r,"stroke-width":n,"font-family":A.getFontFamily(),"text-anchor":"middle","xml:space":"preserve"},s={elements:[{type:"path",attr:{id:"X-"+A.getNextId().replace("svg_",v),d:"m2.9674 294.65-1.9091-2.9389"}},{type:"path",attr:{id:A.getNextId().replace("svg_",v),d:"m2.9959 290.12v1.0583"}},{type:"circle",attr:{id:A.getNextId().replace("svg_",v),cx:"2.9891",cy:"291.41",r:".2581"}},{type:"path",attr:{id:A.getNextId().replace("svg_",v),d:"m2.9959 295.94v-1.0583"}},{type:"circle",attr:{id:A.getNextId().replace("svg_",v),cx:"2.9891",cy:"-294.66",r:".2581",transform:"scale(1,-1)"}}]},d={type:c,x:i,y:o,style:"pointer-events:none"},l=0;l<s.elements.length;l++)$.extend(s.elements[l].attr,a);return $.extend(d,a),u.x=i,u.y=o,g=A.getNextId().replace("svg_",v),(C=k.addSvgGroupFromJson({group:"g",id:g,type:c,attr:d,elements:s.elements})).setAttribute("transform","translate("+i+","+o+") scale(0.005) translate("+-i+","+-o+")"),k.recalculateDimensions(C),I=C.getBBox(),{started:!0}}},mouseMove:function(t){if(A.getMode()===N){var e=A.getZoom(),r=t.event,n=t.mouse_x/e,i=t.mouse_y/e,o=A.getTransformList(C),a=C.getBBox(),s=a.x,d=a.y,l=a.width,g=a.height,c=n-E,v=i-S,u=(Math.min(E,n),Math.min(S,i),Math.abs(n-E)),m=Math.abs(i-S),f=0,h=0,p=g?(g+v)/g:1,w=l?(l+c)/l:1;w=u/I.width||1,p=m/I.height||1,n<E&&(f=I.width),i<S&&(h=I.height);var x=M.createSVGTransform(),y=M.createSVGTransform(),b=M.createSVGTransform();if(x.setTranslate(-(s+f),-(d+h)),!r.shiftKey){var _=Math.min(Math.abs(w),Math.abs(p));w=_*(w<0?-1:1),p=_*(p<0?-1:1)}y.setScale(w,p),b.setTranslate(s+f,d+h),o.appendItem(b),o.appendItem(y),o.appendItem(x),k.recalculateDimensions(C),I=C.getBBox()}},mouseUp:function(t){if(A.getMode()===N)return{keep:t.event.clientX!=u.x&&t.event.clientY!=u.y,element:C,started:!1}},getClassId:function(){return c}}})},window.extValue=function(){svgEditor.addExtension("value",function(l){"use strict";var g,c,v=svgEditor.canvas,u="value",m="svg-ext-"+u,f="VAL_",h={};return{callback:function(){$("#value_panel").hide()},mouseDown:function(t){if(v.getMode()===u){var e=v.getColor("fill"),r=v.getColor("stroke");e!==r&&(e=r);for(var n=t.start_x,i=t.start_y,o={fill:e,stroke:r,"font-size":v.getFontSize(),stroke:r,"stroke-width":0,"font-family":v.getFontFamily(),"text-anchor":"middle","xml:space":"preserve",x:n,y:i},a={elements:[{type:"text",content:"##.##",attr:{id:v.getNextId().replace("svg_",f)}}]},s={type:m,x:n,y:i,style:"pointer-events:none"},d=0;d<a.elements.length;d++)$.extend(a.elements[d].attr,o);return $.extend(s,o),h.x=n,h.y=i,g=v.getNextId().replace("svg_",f),c=l.addSvgGroupFromJson({group:"g",id:g,type:m,attr:s,elements:a.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(v.getMode()===u)return{keep:t.event.clientX!=h.x&&t.event.clientY!=h.y,element:c,started:!1}},getClassId:function(){return m},setGaugeAttribute:function(t){0===t.elem.id.indexOf(f)&&t.elem.children&&t.elem.children.length&&t.elem.children[0].setAttribute(t.attr,t.value)}}})},window.extHtmlInput=function(){window.svgEditor&&svgEditor.addExtension("html_input",function(d){"use strict";var l,g,c=svgEditor.canvas,v=80,u=24,m="html_input",f="svg-ext-"+m,e={};return{callback:function(){$("#html_input_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,i=t.start_y,o=c.getNextId(),a=c.getNextId().replace("svg_","HXI_"),s={elements:[{type:"rect",attr:{x:n,y:i-u,width:v,height:u,"stroke-width":0,id:o}},{type:"foreignObject",content:[{tag:"input",attr:{id:"I-"+a,type:"text",value:""},style:"width:calc(100% - 7px);height:calc(100% - 7px);text-align: right;border: unset;"}],attr:{x:n,y:i-u,height:u,width:v,id:"H-"+a}}]};return l=d.getNextId().replace("svg_","HXI_"),g=d.addSvgGroupFromJson({group:"g",id:l,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlButton=function(){window.svgEditor&&svgEditor.addExtension("html_button",function(d){"use strict";var l,g,c=svgEditor.canvas,v=80,u=24,m="html_button",f="svg-ext-"+m,e={};return{callback:function(){$("#html_button_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,i=t.start_y,o=c.getNextId(),a=c.getNextId().replace("svg_","HXB_"),s={elements:[{type:"rect",attr:{x:n,y:i-u,width:v,height:u,fill:e,stroke:r,"stroke-width":0,id:o}},{type:"foreignObject",content:[{tag:"button",attr:{id:"B-"+a,class:"md-btn  md-btn-raised"},style:"width:100%;height:100%;"}],attr:{x:n,y:i-u,height:u,width:v,id:"H-"+a}}]};return l=c.getNextId().replace("svg_","HXB_"),g=d.addSvgGroupFromJson({group:"g",id:l,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlSelect=function(){window.svgEditor&&svgEditor.addExtension("html_select",function(d){"use strict";var l,g,c=svgEditor.canvas,v=80,u=26,m="html_select",f="svg-ext-"+m,e={};return{callback:function(){$("#html_select_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,i=t.start_y,o=c.getNextId(),a=c.getNextId().replace("svg_","HXS_"),s={elements:[{type:"rect",attr:{x:n,y:i-u,width:v,height:u,fill:e,stroke:r,"stroke-width":0,id:o}},{type:"foreignObject",content:[{tag:"select",attr:{id:"S-"+a},style:"width:100%;height:100%;text-align: right;margin-top:unset;"}],attr:{x:n,y:i-u,height:u,width:v,id:"H-"+a}}]};return l=d.getNextId().replace("svg_","HXS_"),g=d.addSvgGroupFromJson({group:"g",id:l,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extHtmlChart=function(){window.svgEditor&&svgEditor.addExtension("html_chart",function(d){"use strict";var l,g,c=svgEditor.canvas,v=380,u=240,m="html_chart",f="svg-ext-"+m,e={};return{callback:function(){$("#html_chart_panel").hide()},mouseDown:function(t){if(c.getMode()===m){!0;var e=c.getColor("fill"),r=c.getColor("stroke"),n=t.start_x,i=t.start_y,o=c.getNextId(),a=c.getNextId().replace("svg_","HXC_"),s={elements:[{type:"rect",attr:{x:n,y:i-u,width:v,height:u,"stroke-width":0,id:o}},{type:"foreignObject",content:[{tag:"div",attr:{id:"D-"+a},style:"width:100%;height:100%;"}],attr:{x:n,y:i-u,height:u,width:v,id:"H-"+a}}]};return l=d.getNextId().replace("svg_","HXC_"),g=d.addSvgGroupFromJson({group:"g",id:l,type:f,attr:{type:f,style:"pointer-events:none",fill:e,stroke:r,"stroke-width":1,"font-size":c.getFontSize(),"font-family":c.getFontFamily(),"text-anchor":"right","xml:space":"preserve"},elements:s.elements}),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(c.getMode()===m)return{keep:t.event.clientX!=e.x&&t.event.clientY!=e.y,element:g,started:!1}},getClassId:function(){return f}}})},window.extGaugeProgress=function(){window.svgEditor&&svgEditor.addExtension("gauge_progress",function(u){"use strict";var m,f,h=svgEditor.canvas,p=100,w=25,x="gauge_progress",y="svg-ext-"+x,b="GXP_",_={};return{callback:function(){$("#gauge_progress_panel").hide()},mouseDown:function(t){if(h.getMode()===x){var e,r=h.getColor("fill"),n=h.getColor("stroke"),i=h.getStrokeWidth(),o=h.getFontSize(),a=t.start_x,s=t.start_y-p,d={"font-size":o,stroke:n,"stroke-width":i,"font-family":h.getFontFamily(),"xml:space":"preserve"},l=h.getNextId().replace("svg_",b);e=[];for(var g={elements:[{type:"rect",attr:{id:"A-"+h.getNextId().replace("svg_",b),x:a,y:s,width:w,height:p,fill:r}},{type:"rect",attr:{id:"B-"+h.getNextId().replace("svg_",b),x:a,y:s+p/2,width:w,height:p/2,fill:"#1565c0"}},{type:"foreignObject",content:e,attr:{x:a,y:s,height:p,width:w,id:"H-"+l}}]},c={type:y,x:a,y:s,style:"pointer-events:none"},v=0;v<g.elements.length;v++)$.extend(g.elements[v].attr,d);return $.extend(c,d),_.x=a,_.y=s,m=h.getNextId().replace("svg_",b),f=u.addSvgGroupFromJson({group:"g",id:m,type:y,attr:c,elements:g.elements}),{started:!0}}},mouseMove:function(t){h.getMode()},mouseUp:function(t){if(h.getMode()===x)return{keep:t.event.clientX!=_.x&&t.event.clientY!=_.y,element:f,started:!1}},getClassId:function(){return y}}})},window.extGaugeSemaphore=function(){svgEditor.addExtension("gauge_semaphore",function(g){"use strict";var c,v,u=svgEditor.canvas,m="gauge_semaphore",f="svg-ext-"+m,h={};return{callback:function(){$("#gauge_semaphore_panel").hide()},mouseDown:function(t){if(u.getMode()===m){for(var e=u.getColor("fill"),r=u.getColor("stroke"),n=u.getStrokeWidth(),i=t.start_x,o=t.start_y-30,a={fill:e,"font-size":u.getFontSize(),stroke:r,"stroke-width":n,"font-family":u.getFontFamily(),"xml:space":"preserve"},s={elements:[{type:"ellipse",attr:{id:u.getNextId().replace("svg_","GSE_"),cx:"15",cy:"15",rx:"14",ry:"14","stroke-width":"none"}}]},d={type:f,x:i,y:o,style:"pointer-events:none"},l=0;l<s.elements.length;l++)$.extend(s.elements[l].attr,a);return $.extend(d,a),h.x=i,h.y=o,c=u.getNextId().replace("svg_","GSE_"),(v=g.addSvgGroupFromJson({group:"g",id:c,type:f,attr:d,elements:s.elements})).setAttribute("transform","translate("+i+","+o+")"),g.recalculateDimensions(v),v.getBBox(),{started:!0}}},mouseMove:function(t){},mouseUp:function(t){if(u.getMode()===m)return{keep:t.event.clientX!=h.x&&t.event.clientY!=h.y,element:v,started:!1}},getClassId:function(){return f}}})},window.extShapes=function(){window.svgEditor&&svgEditor.addExtension("shapes",function(){"use strict";var k,f,C,E,S,h=svgEditor.shapesList,A=svgEditor.canvas,M={},p="svg-ext-",w={};return{callback:function(){},mouseDown:function(t){var e=A.getMode();if(p="svg-ext-"+e,f=e,void 0!==(k=h.find(function(t){return t.name===f}))){var r=A.getColor("fill"),n=A.getColor("stroke"),i=A.getFontSize(),o=A.getFontFamily(),a=A.getStrokeWidth();A.getStyle();r===n&&(r="#FFFFFF",n="#000000");for(var s=E=t.start_x,d=S=t.start_y,l={fill:r,stroke:n,"stroke-width":a,"font-size":i,"font-family":o,"text-anchor":"middle","xml:space":"preserve"},g={elements:[]},c=0;c<k.content.length;c++){var v=k.content[c],u={id:v.id+A.getNextId().replace("svg_","SHE_"),"stroke-width":a};$.extend(u,v.attr),g.elements.push({type:v.type,attr:u})}var m={type:p,x:s,y:d,style:"pointer-events:none"};return $.extend(m,l),w.x=s,w.y=d,f=A.getNextId().replace("svg_","SHE_"),(C=A.addSvgGroupFromJson({group:"g",id:f,type:p,attr:m,elements:g.elements})).setAttribute("transform","translate("+s+","+d+")"),A.recalculateDimensions(C),M=C.getBBox(),{started:!0}}},mouseMove:function(t){if(void 0!==k){var e=A.getZoom(),r=t.event,n=t.mouse_x/e,i=t.mouse_y/e;svgEditor.curConfig.gridSnapping&&(n=svgedit.utilities.snapToGrid(n),i=svgedit.utilities.snapToGrid(i));var o=A.getTransformList(C),a=C.getBBox(),s=a.x,d=a.y,l=a.width,g=a.height,c=n-E,v=i-S,u=(Math.min(E,n),Math.min(S,i),Math.abs(n-E)),m=Math.abs(i-S),f=0,h=0,p=g?(g+v)/g:1,w=l?(l+c)/l:1;w=u/M.width||1,p=m/M.height||1,n<E&&(f=M.width),i<S&&(h=M.height);var x=svgroot.createSVGTransform(),y=svgroot.createSVGTransform(),b=svgroot.createSVGTransform();if(x.setTranslate(-(s+f),-(d+h)),!r.shiftKey){var _=Math.min(Math.abs(w),Math.abs(p));w=_*(w<0?-1:1),p=_*(p<0?-1:1)}y.setScale(w,p),b.setTranslate(s+f,d+h),o.appendItem(b),o.appendItem(y),o.appendItem(x),A.recalculateDimensions(C),M=C.getBBox()}},mouseUp:function(t){if(void 0!==k)return{keep:t.event.clientX!=w.x&&t.event.clientY!=w.y,element:C,started:!1}},getClassId:function(){return p}}})};